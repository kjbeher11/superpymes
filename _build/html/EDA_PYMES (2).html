
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modelos &#8212; Superintendecia</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'EDA_PYMES (2)';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Exploración de datos" href="edapyme.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Superintendecia - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Superintendecia - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Proyecto Superintendencia PYMEs
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="edapyme.html">Exploración de datos</a></li>




<li class="toctree-l1 current active"><a class="current reference internal" href="#">Modelos</a></li>




</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FEDA_PYMES (2).html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/EDA_PYMES (2).ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Modelos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-paquetes-necesarios">Librerías y paquetes necesarios</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis">Análisis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mirar-por-ano-datos-faltantes">Mirar por año datos faltantes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacion-de-datos">Imputación de datos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verificar-vif">Verificar VIF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelamiento">Modelamiento</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion-logistica-multinomial">Modelo de regresión logística Multinomial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion-logistica-multinomial-generalizado">Modelo de regresión logistica multinomial generalizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgbooost">XGBOOOST</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-svm">Modelo SVM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-knn">Modelo KNN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelamiento-2">Modelamiento 2</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Modelo de regresión logística multinomial</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modelos">
<h1>Modelos<a class="headerlink" href="#modelos" title="Link to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="librerias-y-paquetes-necesarios">
<h1>Librerías y paquetes necesarios<a class="headerlink" href="#librerias-y-paquetes-necesarios" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">class_weight</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">GroupKFold</span><span class="p">,</span> <span class="n">PredefinedSplit</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">class_weight</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelBinarizer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">label_binarize</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">statsmodels.genmod.generalized_estimating_equations</span> <span class="kn">import</span> <span class="n">GEE</span>
<span class="kn">from</span> <span class="nn">statsmodels.discrete.discrete_model</span> <span class="kn">import</span> <span class="n">MNLogit</span> 
<span class="kn">from</span> <span class="nn">statsmodels.genmod.cov_struct</span> <span class="kn">import</span> <span class="n">Independence</span>
<span class="kn">from</span> <span class="nn">statsmodels.genmod.generalized_estimating_equations</span> <span class="kn">import</span> <span class="n">NominalGEE</span>
<span class="kn">from</span> <span class="nn">statsmodels.genmod.cov_struct</span> <span class="kn">import</span> <span class="n">Independence</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">RFE</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">label_binarize</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
<span class="kn">from</span> <span class="nn">sklearn.multiclass</span> <span class="kn">import</span> <span class="n">OneVsRestClassifier</span>
<span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrices</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools</span> <span class="kn">import</span> <span class="n">add_constant</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/My Drive/PYMES/finalpymes.xlsx&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis">
<h1>Análisis<a class="headerlink" href="#analisis" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">headers</span> <span class="o">=</span> <span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;pretty&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---+---------------------------+-----------+----------------------------------------+---------------------------------------------------+--------------------------------------------+--------------------------------+--------------------------------------------+----------------+-------------------------------------------------------------------------------------------+---------------------------+-----------------------------+--------------------+----------------------------------------+-------------------+----------------------+----------------------+-----------------------+----------------------+------------------------+----------------------+-------------+-------------------+-------------------+--------------------+---------------------+-------------------+-------------------+-------------------+-------------------+
|   |       Estado actual       |    NIT    | Concepto del Revisor fiscal en su orme | La compañía está obligada a tener Revisor fiscal? |              Tipo societario               | Cantidad de años de la empresa | Departamento de la dirección del domicilio | Fecha de Corte |           Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)            | Total de activos (Assets) | Total pasivos (Liabilities) |  Razón corriente   | Rotación inventario producto terminado | Rotación cartera  | Rotación proveedores |  Productividad KTNO  |          ROA          |         ROE          | Nivel de endeudamiento | Generación Efectivo  |     FLC     |      FDC/FLC      |        SD         |        FDC         |   Generación FLC    | Tasa de Desempleo | Tasa de Ocupación |        PIB        |      PIB DEP      |
+---+---------------------------+-----------+----------------------------------------+---------------------------------------------------+--------------------------------------------+--------------------------------+--------------------------------------------+----------------+-------------------------------------------------------------------------------------------+---------------------------+-----------------------------+--------------------+----------------------------------------+-------------------+----------------------+----------------------+-----------------------+----------------------+------------------------+----------------------+-------------+-------------------+-------------------+--------------------+---------------------+-------------------+-------------------+-------------------+-------------------+
| 0 |          ACTIVA           | 800000268 |               03. LIMPIO               |                        SI                         | 08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS |              30.0              |                 ATLANTICO                  |      2017      |                                Actividades inmobiliarias.                                 |         3766237.0         |          2810145.0          | 0.2770673194815656 |                  nan                   |        0.0        |         nan          |  -1.759056666666667  |  0.00956764006088836  | 0.03768884165958925  |   0.746141307623498    |  -1.131486929011489  |  -40772.0   |        1.0        |        0.0        |      -40772.0      | -1.131486929011489  |    7.557648041    |     11.548318     | 8535.557382835923 | 36782.62700791498 |
| 1 |          ACTIVA           | 800000276 |               03. LIMPIO               |                        SI                         |            01. SOCIEDAD ANÓNIMA            |              30.0              |                 SANTANDER                  |      2017      |                    Agricultura, ganadería, caza, silvicultura y pesca.                    |        158570380.0        |         107975408.0         | 1.012116577964098  |           22.26238120232659            | 23.42703814767868 |  37.68944667923766   | 0.002229827779511632 | -0.009780243952243792 | -0.03065239368054201 |   0.6809304991260032   | 0.004369197160021846 | -14525925.0 |        1.0        |        0.0        |    -14525925.0     |  9.366385811199873  |    7.630039801    |    211.472511     | 5140.802274862169 | 49333.91088687588 |
| 2 |          ACTIVA           | 800000313 |               03. LIMPIO               |                        SI                         | 08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS |              30.0              |                BOGOTA D.C.                 |      2017      |                                Industrias manufactureras.                                 |         4973845.0         |          1885365.0          | 2.156701857521809  |           126.2668797308069            | 56.29611837647643 |  40.09990848866598   |  0.2251621814081026  | 0.002475348548255927  | 0.003986426980262136 |   0.3790558411048193   |  -18.71393762183236  |  -134970.0  | 1.852263465955398 | 115030.0000000001 | -250000.0000000001 | -10.96247563352827  |    8.729730232    |     173.33773     | 19523.99852216619 | 212289.1419694344 |
| 3 |          ACTIVA           | 800000439 |               03. LIMPIO               |                        SI                         |           03. SOCIEDAD LIMITADA            |              30.0              |                CUNDINAMARCA                |      2017      | Comercio al por mayor y al por menor; reparación de vehículos automotores y motocicletas. |         2969939.0         |          1429029.0          |  2.61471657534948  |           137.5492090925299            | 65.4890345987105  |  61.94919698251261   |  0.2875934303809994  |  0.06271980670310064  |  0.1208857103919113  |   0.4811644279562644   |  -1.449246808464949  |  -81721.0   | 5.966667074558559 | 405880.9999999999 | -487601.9999999999 | -0.4387139375328817 |    8.729730232    |    227.644906     | 8523.01007833835  | 49985.62183771345 |
| 4 |          ACTIVA           | 800000457 |               03. LIMPIO               |                        SI                         |           03. SOCIEDAD LIMITADA            |              30.0              |                BOGOTA D.C.                 |      2017      |                    Actividades profesionales, científicas y técnicas.                     |         5687179.0         |          3098735.0          | 1.330053213776243  |                  0.0                   | 158.8989930876437 |  204.4392197221931   |  0.1536377224044927  |  0.0755460659845593   |  0.1659854337200264  |   0.5448632793165118   |  1.461835845490685   |  628069.0   |        1.0        |        0.0        |      628069.0      |  1.461835845490685  |    8.729730232    |     78.165053     | 83519.07672308842 | 212289.1419694344 |
| 5 |          ACTIVA           | 800000750 |               03. LIMPIO               |                        SI                         |          02. SUCURSAL EXTRANJERA           |              30.0              |                BOGOTA D.C.                 |      2017      |                             Explotación de minas y canteras.                              |        333195657.0        |         130526706.0         | 0.887749815897006  |           2.493111301553211            | 87.24733293869737 |  171.0316578989982   | -0.03816762871691842 | 0.005689470916483164  | 0.009353712004953338 |   0.3917419187729689   |  2.062463766816285   | 17443156.0  |        1.0        |        0.0        |     17443156.0     |  9.201398739362148  |    8.729730232    |     5.876447      | 369.9643265204268 | 212289.1419694344 |
| 6 |          ACTIVA           | 800001020 |               03. LIMPIO               |                        SI                         |            01. SOCIEDAD ANÓNIMA            |              30.0              |                   VALLE                    |      2017      |                   Actividades de servicios administrativos y de apoyo.                    |        29006566.0         |          6050575.0          | 4.789251930601637  |                  0.0                   | 404.2584443266219 |  653.5270796451218   |  3.954458744509553   |  0.09524843444067112  |  0.1203533317293947  |   0.2085932888436363   | -0.6037714951698078  | -1675545.0  |        1.0        |        0.0        |     -1675545.0     | -0.6064596808345066 |    12.47002538    |        nan        |      62898.0      | 80979.08853948898 |
| 7 |          ACTIVA           | 800001047 |               03. LIMPIO               |                        SI                         |           03. SOCIEDAD LIMITADA            |              30.0              |                   VALLE                    |      2017      | Comercio al por mayor y al por menor; reparación de vehículos automotores y motocicletas. |         3806134.0         |          1189678.0          | 3.072351510240586  |           82.80798621152292            | 32.3457489359679  |  47.63873165280584   |  0.2426788518385197  |  0.09886751228411822  |  0.1438216427105979  |   0.3125686063601544   | -0.8150772117150276  |   62170.0   |        1.0        |        0.0        |      62170.0       | 0.1652126079249966  |    12.47002538    |    380.550857     | 16087.79789959558 | 80979.08853948898 |
| 8 |          ACTIVA           | 800001075 |               03. LIMPIO               |                        SI                         |   05. SOCIEDAD EN COMANDITA POR ACCIONES   |              20.0              |                BOGOTA D.C.                 |      2017      |                    Agricultura, ganadería, caza, silvicultura y pesca.                    |        57723657.0         |         20259516.0          | 1.400387248183013  |            43.5193362577913            | 210.6976169396886 |  208.0329760983316   |  0.1930637944997342  | 0.004913548703263898  | 0.007570652694265698 |   0.3509742288157522   | -0.0377360486270749  |  283628.0   |        1.0        |        0.0        |      283628.0      |         1.0         |    8.729730232    |    270.790935     | 13.45199351238249 | 212289.1419694344 |
| 9 | ACUERDO DE REORGANIZACION | 800001161 |               03. LIMPIO               |                        SI                         | 08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS |              30.0              |                 ANTIOQUIA                  |      2017      |                                Industrias manufactureras.                                 |         5790019.0         |          4005805.0          | 1.008441249636465  |           6502.498055147376            | 8656.569699127649 |   8746.41196300458   |  0.4013292979645125  |  -0.0082355515586391  | -0.02672549369077925 |   0.6918466070664017   |  -0.036385370354836  |   1735.0    |        1.0        |        0.0        |       1735.0       | -0.036385370354836  |    8.274572445    |    395.010978     | 20388.20480577755 | 120465.3882884336 |
+---+---------------------------+-----------+----------------------------------------+---------------------------------------------------+--------------------------------------------+--------------------------------+--------------------------------------------+----------------+-------------------------------------------------------------------------------------------+---------------------------+-----------------------------+--------------------+----------------------------------------+-------------------+----------------------+----------------------+-----------------------+----------------------+------------------------+----------------------+-------------+-------------------+-------------------+--------------------+---------------------+-------------------+-------------------+-------------------+-------------------+
</pre></div>
</div>
</div>
</div>
<p>visualizamos las primeras 10 filas del conjunto de datos en un formato tabular bien estructurado, facilitando la interpretación de las variables y sus valores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Número de filas: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Número de columnas: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Número de filas: 141621
Número de columnas: 29
</pre></div>
</div>
</div>
</div>
<p>Se identificó que el dataset contiene 141,621 filas y 29 columnas,</p>
<p><strong>Filtramos el conjuto de datos</strong></p>
<p>Se filtra el conjunto de datos, seleccionando únicamente los registros donde la variable “SD” (Servicio de Deuda) es mayor a cero. Este filtro es esencial, ya que permite analizar exclusivamente a las empresas que efectivamente tienen un registro de deuda. En el análisis preliminar, se identificó que ciertas empresas mostraban valores extremadamente altos y positivos en métricas relacionadas con la capacidad de cubrir el servicio de deuda.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datos_filtrados</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">datos_filtrados</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>37168
</pre></div>
</div>
</div>
</div>
<p>El conjunto de datos contiene 37,168 registros después del filtrado. Este valor refleja la cantidad de observaciones relevantes que cumplen con los criterios establecidos, en este caso, aquellas empresas que tienen datos positivos en la variable “Servicio de Deuda” (SD).</p>
<p><strong>Tipos de variables</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">variable_types</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">variable_types</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Data Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Count&#39;</span><span class="p">]</span>

<span class="n">variable_types</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-45d49115-c7ae-4348-9d56-4e7d4910c6a3" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Data Type</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>float64</td>
      <td>21</td>
    </tr>
    <tr>
      <th>1</th>
      <td>object</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>int64</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-45d49115-c7ae-4348-9d56-4e7d4910c6a3')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-45d49115-c7ae-4348-9d56-4e7d4910c6a3 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-45d49115-c7ae-4348-9d56-4e7d4910c6a3');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-8681eb0a-8e17-4a04-84cc-6896f186e8aa">
  <button class="colab-df-quickchart" onclick="quickchart('df-8681eb0a-8e17-4a04-84cc-6896f186e8aa')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-8681eb0a-8e17-4a04-84cc-6896f186e8aa button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_7382bb3a-904b-459e-a1ba-b4b29154da0e">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('variable_types')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_7382bb3a-904b-459e-a1ba-b4b29154da0e button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('variable_types');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<p>Muestra que el dataset contiene 21 variables de tipo float64, 6 variables de tipo object y 2 variables de tipo int64</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resumen_datos</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">resumen</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_filas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">columna</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">faltantes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">columna</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">ceros</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">columna</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">porcentaje_faltantes</span> <span class="o">=</span> <span class="p">(</span><span class="n">faltantes</span> <span class="o">/</span> <span class="n">total_filas</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">supera_10</span> <span class="o">=</span> <span class="s2">&quot;Sí&quot;</span> <span class="k">if</span> <span class="n">porcentaje_faltantes</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span>

        <span class="n">resumen</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;Columna&quot;</span><span class="p">:</span> <span class="n">columna</span><span class="p">,</span>
            <span class="s2">&quot;Faltantes&quot;</span><span class="p">:</span> <span class="n">faltantes</span><span class="p">,</span>
            <span class="s2">&quot;Ceros&quot;</span><span class="p">:</span> <span class="n">ceros</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">%F</span><span class="s2">altantes&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">porcentaje_faltantes</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Supera 10%&quot;</span><span class="p">:</span> <span class="n">supera_10</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">resumen</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tabla_resumen</span> <span class="o">=</span> <span class="n">resumen_datos</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">tabla_resumen</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|    | Columna                                                              |   Faltantes |   Ceros | %Faltantes   | Supera 10%   |
+====+======================================================================+=============+=========+==============+==============+
|  0 | Estado actual                                                        |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  1 | NIT                                                                  |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  2 | Concepto del Revisor fiscal en su orme                               |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  3 | La compañía está obligada a tener Revisor fiscal?                    |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  4 | Tipo societario                                                      |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  5 | Cantidad de años de la empresa                                       |          19 |     100 | 0.05%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  6 | Departamento de la dirección del domicilio                           |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  7 | Fecha de Corte                                                       |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  8 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
|  9 | Total de activos (Assets)                                            |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 10 | Total pasivos (Liabilities)                                          |           0 |       9 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 11 | Razón corriente                                                      |          57 |       5 | 0.15%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 12 | Rotación inventario producto terminado                               |        5308 |    5942 | 14.28%       | Sí           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 13 | Rotación cartera                                                     |         592 |     486 | 1.59%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 14 | Rotación proveedores                                                 |        5308 |     281 | 14.28%       | Sí           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 15 | Productividad KTNO                                                   |         592 |       0 | 1.59%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 16 | ROA                                                                  |           0 |      34 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 17 | ROE                                                                  |           0 |      34 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 18 | Nivel de endeudamiento                                               |           0 |       9 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 19 | Generación Efectivo                                                  |          34 |     315 | 0.09%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 20 | FLC                                                                  |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 21 | FDC/FLC                                                              |           0 |     106 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 22 | SD                                                                   |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 23 | FDC                                                                  |           0 |     106 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 24 | Generación FLC                                                       |          34 |       0 | 0.09%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 25 | Tasa de Desempleo                                                    |         308 |       0 | 0.83%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 26 | Tasa de Ocupación                                                    |        2169 |       0 | 5.84%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 27 | PIB                                                                  |           2 |       0 | 0.01%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
| 28 | PIB DEP                                                              |           0 |       0 | 0.00%        | No           |
+----+----------------------------------------------------------------------+-------------+---------+--------------+--------------+
</pre></div>
</div>
</div>
</div>
<p>Generamos un resumen detallado de las columnas del conjunto de datos, analizando valores faltantes, ceros y el porcentaje de faltantes para identificar posibles problemas de calidad. Los resultados muestran que las columnas tienen una baja incidencia de valores faltantes. Ninguna columna supera el umbral crítico del 10% de valores faltantes, lo que asegura que el conjunto de datos es lo suficientemente completo y adecuado para los procesos de modelado sin requerir imputación significativa de valores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_valores_no_nulos</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;FDC/FLC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Número de valores no nulos para FDC/FLC: </span><span class="si">{</span><span class="n">num_valores_no_nulos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Número de valores no nulos para FDC/FLC: 37168
</pre></div>
</div>
</div>
</div>
<section id="mirar-por-ano-datos-faltantes">
<h2>Mirar por año datos faltantes<a class="headerlink" href="#mirar-por-ano-datos-faltantes" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">missing_data_by_year</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">missing_data_summary</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>  
        <span class="n">year_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">missing_count</span> <span class="o">=</span> <span class="n">year_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">missing_percent</span> <span class="o">=</span> <span class="p">(</span><span class="n">missing_count</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_data</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">missing_data_summary</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
                <span class="s1">&#39;Column&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                <span class="s1">&#39;Missing Count&#39;</span><span class="p">:</span> <span class="n">missing_count</span><span class="p">,</span>
                <span class="s1">&#39;Missing Percentage&#39;</span><span class="p">:</span> <span class="n">missing_percent</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">missing_data_summary</span><span class="p">)</span>

<span class="n">missing_data_df</span> <span class="o">=</span> <span class="n">missing_data_by_year</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">missing_data_df</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|     |   Year | Column                                                               |   Missing Count |   Missing Percentage |
+=====+========+======================================================================+=================+======================+
|   0 |   2017 | Estado actual                                                        |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   1 |   2017 | NIT                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   2 |   2017 | Concepto del Revisor fiscal en su orme                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   3 |   2017 | La compañía está obligada a tener Revisor fiscal?                    |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   4 |   2017 | Tipo societario                                                      |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   5 |   2017 | Cantidad de años de la empresa                                       |               1 |            0.0229516 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   6 |   2017 | Departamento de la dirección del domicilio                           |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   7 |   2017 | Fecha de Corte                                                       |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   8 |   2017 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|   9 |   2017 | Total de activos (Assets)                                            |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  10 |   2017 | Total pasivos (Liabilities)                                          |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  11 |   2017 | Razón corriente                                                      |               5 |            0.114758  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  12 |   2017 | Rotación inventario producto terminado                               |             623 |           14.2988    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  13 |   2017 | Rotación cartera                                                     |              66 |            1.5148    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  14 |   2017 | Rotación proveedores                                                 |             623 |           14.2988    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  15 |   2017 | Productividad KTNO                                                   |              66 |            1.5148    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  16 |   2017 | ROA                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  17 |   2017 | ROE                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  18 |   2017 | Nivel de endeudamiento                                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  19 |   2017 | Generación Efectivo                                                  |               2 |            0.0459031 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  20 |   2017 | FLC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  21 |   2017 | FDC/FLC                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  22 |   2017 | SD                                                                   |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  23 |   2017 | FDC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  24 |   2017 | Generación FLC                                                       |               2 |            0.0459031 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  25 |   2017 | Tasa de Desempleo                                                    |              29 |            0.665596  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  26 |   2017 | Tasa de Ocupación                                                    |             239 |            5.48543   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  27 |   2017 | PIB                                                                  |               1 |            0.0229516 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  28 |   2017 | PIB DEP                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  29 |   2018 | Estado actual                                                        |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  30 |   2018 | NIT                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  31 |   2018 | Concepto del Revisor fiscal en su orme                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  32 |   2018 | La compañía está obligada a tener Revisor fiscal?                    |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  33 |   2018 | Tipo societario                                                      |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  34 |   2018 | Cantidad de años de la empresa                                       |               2 |            0.0490436 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  35 |   2018 | Departamento de la dirección del domicilio                           |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  36 |   2018 | Fecha de Corte                                                       |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  37 |   2018 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  38 |   2018 | Total de activos (Assets)                                            |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  39 |   2018 | Total pasivos (Liabilities)                                          |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  40 |   2018 | Razón corriente                                                      |               6 |            0.147131  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  41 |   2018 | Rotación inventario producto terminado                               |             579 |           14.1981    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  42 |   2018 | Rotación cartera                                                     |              70 |            1.71653   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  43 |   2018 | Rotación proveedores                                                 |             579 |           14.1981    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  44 |   2018 | Productividad KTNO                                                   |              70 |            1.71653   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  45 |   2018 | ROA                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  46 |   2018 | ROE                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  47 |   2018 | Nivel de endeudamiento                                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  48 |   2018 | Generación Efectivo                                                  |               7 |            0.171653  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  49 |   2018 | FLC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  50 |   2018 | FDC/FLC                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  51 |   2018 | SD                                                                   |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  52 |   2018 | FDC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  53 |   2018 | Generación FLC                                                       |               7 |            0.171653  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  54 |   2018 | Tasa de Desempleo                                                    |              28 |            0.686611  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  55 |   2018 | Tasa de Ocupación                                                    |             224 |            5.49289   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  56 |   2018 | PIB                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  57 |   2018 | PIB DEP                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  58 |   2019 | Estado actual                                                        |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  59 |   2019 | NIT                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  60 |   2019 | Concepto del Revisor fiscal en su orme                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  61 |   2019 | La compañía está obligada a tener Revisor fiscal?                    |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  62 |   2019 | Tipo societario                                                      |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  63 |   2019 | Cantidad de años de la empresa                                       |               2 |            0.0378931 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  64 |   2019 | Departamento de la dirección del domicilio                           |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  65 |   2019 | Fecha de Corte                                                       |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  66 |   2019 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  67 |   2019 | Total de activos (Assets)                                            |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  68 |   2019 | Total pasivos (Liabilities)                                          |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  69 |   2019 | Razón corriente                                                      |               7 |            0.132626  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  70 |   2019 | Rotación inventario producto terminado                               |             719 |           13.6226    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  71 |   2019 | Rotación cartera                                                     |              81 |            1.53467   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  72 |   2019 | Rotación proveedores                                                 |             719 |           13.6226    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  73 |   2019 | Productividad KTNO                                                   |              81 |            1.53467   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  74 |   2019 | ROA                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  75 |   2019 | ROE                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  76 |   2019 | Nivel de endeudamiento                                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  77 |   2019 | Generación Efectivo                                                  |               5 |            0.0947329 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  78 |   2019 | FLC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  79 |   2019 | FDC/FLC                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  80 |   2019 | SD                                                                   |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  81 |   2019 | FDC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  82 |   2019 | Generación FLC                                                       |               5 |            0.0947329 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  83 |   2019 | Tasa de Desempleo                                                    |              42 |            0.795756  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  84 |   2019 | Tasa de Ocupación                                                    |             309 |            5.85449   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  85 |   2019 | PIB                                                                  |               1 |            0.0189466 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  86 |   2019 | PIB DEP                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  87 |   2020 | Estado actual                                                        |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  88 |   2020 | NIT                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  89 |   2020 | Concepto del Revisor fiscal en su orme                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  90 |   2020 | La compañía está obligada a tener Revisor fiscal?                    |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  91 |   2020 | Tipo societario                                                      |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  92 |   2020 | Cantidad de años de la empresa                                       |               3 |            0.0514403 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  93 |   2020 | Departamento de la dirección del domicilio                           |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  94 |   2020 | Fecha de Corte                                                       |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  95 |   2020 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  96 |   2020 | Total de activos (Assets)                                            |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  97 |   2020 | Total pasivos (Liabilities)                                          |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  98 |   2020 | Razón corriente                                                      |               3 |            0.0514403 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
|  99 |   2020 | Rotación inventario producto terminado                               |             814 |           13.9575    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 100 |   2020 | Rotación cartera                                                     |              81 |            1.38889   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 101 |   2020 | Rotación proveedores                                                 |             814 |           13.9575    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 102 |   2020 | Productividad KTNO                                                   |              81 |            1.38889   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 103 |   2020 | ROA                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 104 |   2020 | ROE                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 105 |   2020 | Nivel de endeudamiento                                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 106 |   2020 | Generación Efectivo                                                  |               1 |            0.0171468 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 107 |   2020 | FLC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 108 |   2020 | FDC/FLC                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 109 |   2020 | SD                                                                   |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 110 |   2020 | FDC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 111 |   2020 | Generación FLC                                                       |               1 |            0.0171468 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 112 |   2020 | Tasa de Desempleo                                                    |              43 |            0.737311  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 113 |   2020 | Tasa de Ocupación                                                    |             344 |            5.89849   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 114 |   2020 | PIB                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 115 |   2020 | PIB DEP                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 116 |   2021 | Estado actual                                                        |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 117 |   2021 | NIT                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 118 |   2021 | Concepto del Revisor fiscal en su orme                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 119 |   2021 | La compañía está obligada a tener Revisor fiscal?                    |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 120 |   2021 | Tipo societario                                                      |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 121 |   2021 | Cantidad de años de la empresa                                       |               7 |            0.118745  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 122 |   2021 | Departamento de la dirección del domicilio                           |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 123 |   2021 | Fecha de Corte                                                       |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 124 |   2021 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 125 |   2021 | Total de activos (Assets)                                            |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 126 |   2021 | Total pasivos (Liabilities)                                          |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 127 |   2021 | Razón corriente                                                      |              15 |            0.254453  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 128 |   2021 | Rotación inventario producto terminado                               |             836 |           14.1815    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 129 |   2021 | Rotación cartera                                                     |             107 |            1.8151    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 130 |   2021 | Rotación proveedores                                                 |             836 |           14.1815    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 131 |   2021 | Productividad KTNO                                                   |             107 |            1.8151    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 132 |   2021 | ROA                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 133 |   2021 | ROE                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 134 |   2021 | Nivel de endeudamiento                                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 135 |   2021 | Generación Efectivo                                                  |               7 |            0.118745  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 136 |   2021 | FLC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 137 |   2021 | FDC/FLC                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 138 |   2021 | SD                                                                   |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 139 |   2021 | FDC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 140 |   2021 | Generación FLC                                                       |               7 |            0.118745  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 141 |   2021 | Tasa de Desempleo                                                    |              51 |            0.86514   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 142 |   2021 | Tasa de Ocupación                                                    |             365 |            6.19169   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 143 |   2021 | PIB                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 144 |   2021 | PIB DEP                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 145 |   2022 | Estado actual                                                        |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 146 |   2022 | NIT                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 147 |   2022 | Concepto del Revisor fiscal en su orme                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 148 |   2022 | La compañía está obligada a tener Revisor fiscal?                    |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 149 |   2022 | Tipo societario                                                      |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 150 |   2022 | Cantidad de años de la empresa                                       |               1 |            0.0169205 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 151 |   2022 | Departamento de la dirección del domicilio                           |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 152 |   2022 | Fecha de Corte                                                       |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 153 |   2022 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 154 |   2022 | Total de activos (Assets)                                            |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 155 |   2022 | Total pasivos (Liabilities)                                          |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 156 |   2022 | Razón corriente                                                      |              11 |            0.186125  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 157 |   2022 | Rotación inventario producto terminado                               |             902 |           15.2623    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 158 |   2022 | Rotación cartera                                                     |              99 |            1.67513   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 159 |   2022 | Rotación proveedores                                                 |             902 |           15.2623    |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 160 |   2022 | Productividad KTNO                                                   |              99 |            1.67513   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 161 |   2022 | ROA                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 162 |   2022 | ROE                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 163 |   2022 | Nivel de endeudamiento                                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 164 |   2022 | Generación Efectivo                                                  |               6 |            0.101523  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 165 |   2022 | FLC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 166 |   2022 | FDC/FLC                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 167 |   2022 | SD                                                                   |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 168 |   2022 | FDC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 169 |   2022 | Generación FLC                                                       |               6 |            0.101523  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 170 |   2022 | Tasa de Desempleo                                                    |              54 |            0.913706  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 171 |   2022 | Tasa de Ocupación                                                    |             361 |            6.10829   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 172 |   2022 | PIB                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 173 |   2022 | PIB DEP                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 174 |   2023 | Estado actual                                                        |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 175 |   2023 | NIT                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 176 |   2023 | Concepto del Revisor fiscal en su orme                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 177 |   2023 | La compañía está obligada a tener Revisor fiscal?                    |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 178 |   2023 | Tipo societario                                                      |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 179 |   2023 | Cantidad de años de la empresa                                       |               3 |            0.0515641 |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 180 |   2023 | Departamento de la dirección del domicilio                           |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 181 |   2023 | Fecha de Corte                                                       |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 182 |   2023 | Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU) |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 183 |   2023 | Total de activos (Assets)                                            |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 184 |   2023 | Total pasivos (Liabilities)                                          |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 185 |   2023 | Razón corriente                                                      |              10 |            0.17188   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 186 |   2023 | Rotación inventario producto terminado                               |             835 |           14.352     |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 187 |   2023 | Rotación cartera                                                     |              88 |            1.51255   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 188 |   2023 | Rotación proveedores                                                 |             835 |           14.352     |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 189 |   2023 | Productividad KTNO                                                   |              88 |            1.51255   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 190 |   2023 | ROA                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 191 |   2023 | ROE                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 192 |   2023 | Nivel de endeudamiento                                               |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 193 |   2023 | Generación Efectivo                                                  |               6 |            0.103128  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 194 |   2023 | FLC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 195 |   2023 | FDC/FLC                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 196 |   2023 | SD                                                                   |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 197 |   2023 | FDC                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 198 |   2023 | Generación FLC                                                       |               6 |            0.103128  |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 199 |   2023 | Tasa de Desempleo                                                    |              61 |            1.04847   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 200 |   2023 | Tasa de Ocupación                                                    |             327 |            5.62049   |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 201 |   2023 | PIB                                                                  |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
| 202 |   2023 | PIB DEP                                                              |               0 |            0         |
+-----+--------+----------------------------------------------------------------------+-----------------+----------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_missing_data_heatmap</span><span class="p">(</span><span class="n">missing_data_df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots a heatmap of missing data for each year.&quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">missing_data_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">year_data</span> <span class="o">=</span> <span class="n">missing_data_df</span><span class="p">[</span><span class="n">missing_data_df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="n">pivot_table</span> <span class="o">=</span> <span class="n">year_data</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Column&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Missing Percentage&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pivot_table</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Missing Percentage&#39;</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing Data Heatmap for Year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Column&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_missing_data_heatmap</span><span class="p">(</span><span class="n">missing_data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f623df4a295f08852d6cd45ade8c43fe3d5f163bd63da8aafd42bd40e59920a6.png" src="_images/f623df4a295f08852d6cd45ade8c43fe3d5f163bd63da8aafd42bd40e59920a6.png" />
<img alt="_images/61979ff44c871cb3b98e7b78e34bcbc909d2f45e05869299e76d08b5de6d720b.png" src="_images/61979ff44c871cb3b98e7b78e34bcbc909d2f45e05869299e76d08b5de6d720b.png" />
<img alt="_images/33d7046f5662003822738ae8676b5200dd98b4fc51ab70b2cc856bab084cd906.png" src="_images/33d7046f5662003822738ae8676b5200dd98b4fc51ab70b2cc856bab084cd906.png" />
<img alt="_images/1adab9e7488b00b55d26bb59f0e23c4a28ee870e7df8f055464fc4ece45c1fe5.png" src="_images/1adab9e7488b00b55d26bb59f0e23c4a28ee870e7df8f055464fc4ece45c1fe5.png" />
<img alt="_images/b2988f63f72c5589cfb52d97366788d52d15dbc2e8247ebee703f8e8f77d0277.png" src="_images/b2988f63f72c5589cfb52d97366788d52d15dbc2e8247ebee703f8e8f77d0277.png" />
<img alt="_images/8196878efaf13cc9b1cff8c599e4e8f546c82be421a94bf06ba333bf9fd727b8.png" src="_images/8196878efaf13cc9b1cff8c599e4e8f546c82be421a94bf06ba333bf9fd727b8.png" />
<img alt="_images/6fb97c30900f54aa924e6d7a7d603549770ac53b4422c4e4ba7e82a4b800f025.png" src="_images/6fb97c30900f54aa924e6d7a7d603549770ac53b4422c4e4ba7e82a4b800f025.png" />
</div>
</div>
<p>implementamos una función para generar un heatmap (mapa de calor) que muestra el porcentaje de datos faltantes por columna para cada año. Muestra los porcentajes de datos faltantes, creando una tabla adecuada para la representación gráfica mediante un heatmap</p>
</section>
<section id="imputacion-de-datos">
<h2>Imputación de datos<a class="headerlink" href="#imputacion-de-datos" title="Link to this heading">#</a></h2>
<p>Se realiza el proceso de imputación de datos para variables numéricas, por lo que se procede a analizar su distribución</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Volver al NIT categorico</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;NIT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;NIT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">numericos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">numericos</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Cantidad de años de la empresa&#39;, &#39;Fecha de Corte&#39;,
       &#39;Total de activos (Assets)&#39;, &#39;Total pasivos (Liabilities)&#39;,
       &#39;Razón corriente&#39;, &#39;Rotación inventario producto terminado&#39;,
       &#39;Rotación cartera&#39;, &#39;Rotación proveedores&#39;, &#39;Productividad KTNO&#39;, &#39;ROA&#39;,
       &#39;ROE&#39;, &#39;Nivel de endeudamiento&#39;, &#39;Generación Efectivo&#39;, &#39;FLC&#39;,
       &#39;FDC/FLC&#39;, &#39;SD&#39;, &#39;FDC&#39;, &#39;Generación FLC&#39;, &#39;Tasa de Desempleo&#39;,
       &#39;Tasa de Ocupación&#39;, &#39;PIB&#39;, &#39;PIB DEP&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>El listado de columnas proporciona una visión detallada de las variables que componen el conjunto de datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normality_test_by_year</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">year_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># Shapiro-Wilk requires at least 3 data points</span>
              <span class="n">statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">year_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
              <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                  <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
                  <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                  <span class="s1">&#39;Statistic&#39;</span><span class="p">:</span> <span class="n">statistic</span><span class="p">,</span>
                  <span class="s1">&#39;P-value&#39;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
                  <span class="s1">&#39;Normal&#39;</span><span class="p">:</span> <span class="n">p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span>
              <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                  <span class="s1">&#39;Year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
                  <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span>
                  <span class="s1">&#39;Statistic&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;P-value&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Normal&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span>
              <span class="p">})</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">normality_results</span> <span class="o">=</span> <span class="n">normality_test_by_year</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">normality_results</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;grid&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+-----+--------+----------------------------------------+-------------+--------------+----------+
|     |   Year | Variable                               |   Statistic |      P-value | Normal   |
+=====+========+========================================+=============+==============+==========+
|   0 |   2017 | Cantidad de años de la empresa         |  0.853403   | 3.137e-53    | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   1 |   2017 | Fecha de Corte                         |  1          | 1            | True     |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   2 |   2017 | Total de activos (Assets)              |  0.451463   | 7.8831e-79   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   3 |   2017 | Total pasivos (Liabilities)            |  0.419361   | 4.76258e-80  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   4 |   2017 | Razón corriente                        |  0.0132088  | 7.63164e-92  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   5 |   2017 | Rotación inventario producto terminado |  0.00388596 | 4.63755e-88  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   6 |   2017 | Rotación cartera                       |  0.00345161 | 1.06608e-91  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   7 |   2017 | Rotación proveedores                   |  0.0039006  | 4.64108e-88  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   8 |   2017 | Productividad KTNO                     |  0.00344949 | 1.06596e-91  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|   9 |   2017 | ROA                                    |  0.00574832 | 4.76874e-92  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  10 |   2017 | ROE                                    |  0.0537598  | 6.58149e-91  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  11 |   2017 | Nivel de endeudamiento                 |  0.0269398  | 1.49794e-91  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  12 |   2017 | Generación Efectivo                    |  0.0299138  | 1.81169e-91  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  13 |   2017 | FLC                                    |  0.290325   | 1.99908e-84  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  14 |   2017 | FDC/FLC                                |  0.0892392  | 4.93792e-90  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  15 |   2017 | SD                                     |  0.194228   | 2.94753e-87  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  16 |   2017 | FDC                                    |  0.342276   | 9.3961e-83   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  17 |   2017 | Generación FLC                         |  0.00670579 | 5.16158e-92  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  18 |   2017 | Tasa de Desempleo                      |  0.721679   | 6.94693e-65  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  19 |   2017 | Tasa de Ocupación                      |  0.907277   | 1.37583e-44  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  20 |   2017 | PIB                                    |  0.834883   | 2.51116e-55  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  21 |   2017 | PIB DEP                                |  0.819111   | 5.74543e-57  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  22 |   2018 | Cantidad de años de la empresa         |  0.928435   | 2.09012e-40  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  23 |   2018 | Fecha de Corte                         |  1          | 1            | True     |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  24 |   2018 | Total de activos (Assets)              |  0.426524   | 3.43516e-78  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  25 |   2018 | Total pasivos (Liabilities)            |  0.470074   | 1.59259e-76  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  26 |   2018 | Razón corriente                        |  0.00442501 | 2.66497e-90  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  27 |   2018 | Rotación inventario producto terminado |  0.00416308 | 2.20735e-86  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  28 |   2018 | Rotación cartera                       |  0.00712696 | 7.97053e-90  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  29 |   2018 | Rotación proveedores                   |  0.00414242 | 2.20501e-86  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  30 |   2018 | Productividad KTNO                     |  0.0459344  | 6.40457e-89  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  31 |   2018 | ROA                                    |  0.515415   | 1.16645e-74  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  32 |   2018 | ROE                                    |  0.00967363 | 3.2199e-90   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  33 |   2018 | Nivel de endeudamiento                 |  0.38061    | 7.82447e-80  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  34 |   2018 | Generación Efectivo                    |  0.0381071  | 1.64475e-89  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  35 |   2018 | FLC                                    |  0.502655   | 3.36843e-75  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  36 |   2018 | FDC/FLC                                |  0.00909025 | 3.12178e-90  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  37 |   2018 | SD                                     |  0.214594   | 5.24046e-85  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  38 |   2018 | FDC                                    |  0.350156   | 7.26159e-81  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  39 |   2018 | Generación FLC                         |  0.00532525 | 2.8364e-90   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  40 |   2018 | Tasa de Desempleo                      |  0.861845   | 7.50495e-51  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  41 |   2018 | Tasa de Ocupación                      |  0.909377   | 4.11146e-43  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  42 |   2018 | PIB                                    |  0.824244   | 3.67081e-55  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  43 |   2018 | PIB DEP                                |  0.821237   | 1.83471e-55  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  44 |   2019 | Cantidad de años de la empresa         |  0.914526   | 1.52911e-47  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  45 |   2019 | Fecha de Corte                         |  1          | 1            | True     |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  46 |   2019 | Total de activos (Assets)              |  0.0821628  | 2.82979e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  47 |   2019 | Total pasivos (Liabilities)            |  0.108159   | 1.3496e-94   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  48 |   2019 | Razón corriente                        |  0.028385   | 1.36697e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  49 |   2019 | Rotación inventario producto terminado |  0.00990082 | 3.76429e-93  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  50 |   2019 | Rotación cartera                       |  0.0150028  | 1.55408e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  51 |   2019 | Rotación proveedores                   |  0.00385585 | 2.71602e-93  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  52 |   2019 | Productividad KTNO                     |  0.00503136 | 8.94473e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  53 |   2019 | ROA                                    |  0.00376779 | 3.18327e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  54 |   2019 | ROE                                    |  0.07834    | 2.25635e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  55 |   2019 | Nivel de endeudamiento                 |  0.00287837 | 3.03071e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  56 |   2019 | Generación Efectivo                    |  0.0048625  | 3.58767e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  57 |   2019 | FLC                                    |  0.00863942 | 4.16871e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  58 |   2019 | FDC/FLC                                |  0.0893199  | 4.33359e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  59 |   2019 | SD                                     |  0.00923907 | 4.30977e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  60 |   2019 | FDC                                    |  0.223938   | 2.392e-91    | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  61 |   2019 | Generación FLC                         |  0.0147865  | 6.225e-97    | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  62 |   2019 | Tasa de Desempleo                      |  0.87597    | 9.05856e-54  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  63 |   2019 | Tasa de Ocupación                      |  0.903728   | 1.83568e-48  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  64 |   2019 | PIB                                    |  0.815483   | 3.59504e-61  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  65 |   2019 | PIB DEP                                |  0.834847   | 4.20748e-59  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  66 |   2020 | Cantidad de años de la empresa         |  0.917486   | 1.04152e-48  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  67 |   2020 | Fecha de Corte                         |  1          | 1            | True     |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  68 |   2020 | Total de activos (Assets)              |  0.385361   | 1.49155e-88  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  69 |   2020 | Total pasivos (Liabilities)            |  0.374489   | 5.92061e-89  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  70 |   2020 | Razón corriente                        |  0.072057   | 3.27955e-98  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  71 |   2020 | Rotación inventario producto terminado |  0.00327925 | 7.16126e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  72 |   2020 | Rotación cartera                       |  0.0155502  | 2.8475e-99   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  73 |   2020 | Rotación proveedores                   |  0.0152911  | 1.38692e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  74 |   2020 | Productividad KTNO                     |  0.0179273  | 3.25843e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  75 |   2020 | ROA                                    |  0.205036   | 1.5607e-94   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  76 |   2020 | ROE                                    |  0.0122313  | 9.77938e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  77 |   2020 | Nivel de endeudamiento                 |  0.680476   | 3.04564e-74  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  78 |   2020 | Generación Efectivo                    |  0.00865425 | 8.07597e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  79 |   2020 | FLC                                    |  0.012126   | 9.72123e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  80 |   2020 | FDC/FLC                                |  0.00268911 | 5.7105e-100  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  81 |   2020 | SD                                     |  0.0122817  | 9.80731e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  82 |   2020 | FDC                                    |  0.263364   | 9.67172e-93  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  83 |   2020 | Generación FLC                         |  0.0139071  | 1.08702e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  84 |   2020 | Tasa de Desempleo                      |  0.897945   | 3.18203e-52  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  85 |   2020 | Tasa de Ocupación                      |  0.911636   | 8.61298e-49  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  86 |   2020 | PIB                                    |  0.80354    | 1.94031e-64  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  87 |   2020 | PIB DEP                                |  0.838666   | 1.13804e-60  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  88 |   2021 | Cantidad de años de la empresa         |  0.917334   | 6.43102e-49  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  89 |   2021 | Fecha de Corte                         |  1          | 1            | True     |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  90 |   2021 | Total de activos (Assets)              |  0.373838   | 2.97974e-89  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  91 |   2021 | Total pasivos (Liabilities)            |  0.360961   | 1.01436e-89  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  92 |   2021 | Razón corriente                        |  0.0101291  | 5.17681e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  93 |   2021 | Rotación inventario producto terminado |  0.00758145 | 5.47643e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  94 |   2021 | Rotación cartera                       |  0.00425118 | 1.0053e-99   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  95 |   2021 | Rotación proveedores                   |  0.00915742 | 5.97287e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  96 |   2021 | Productividad KTNO                     |  0.00273113 | 9.23119e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  97 |   2021 | ROA                                    |  0.133814   | 7.34304e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  98 |   2021 | ROE                                    |  0.0438666  | 3.06451e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
|  99 |   2021 | Nivel de endeudamiento                 |  0.638266   | 4.14732e-77  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 100 |   2021 | Generación Efectivo                    |  0.0638024  | 1.06812e-98  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 101 |   2021 | FLC                                    |  0.273323   | 1.0543e-92   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 102 |   2021 | FDC/FLC                                |  0.122941   | 3.69017e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 103 |   2021 | SD                                     |  0.14628    | 1.63126e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 104 |   2021 | FDC                                    |  0.226494   | 3.59173e-94  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 105 |   2021 | Generación FLC                         |  0.0780728  | 2.5087e-98   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 106 |   2021 | Tasa de Desempleo                      |  0.782018   | 1.61547e-66  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 107 |   2021 | Tasa de Ocupación                      |  0.902852   | 1.55352e-50  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 108 |   2021 | PIB                                    |  0.831345   | 9.96123e-62  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 109 |   2021 | PIB DEP                                |  0.842485   | 1.95055e-60  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 110 |   2022 | Cantidad de años de la empresa         |  0.916516   | 3.79156e-49  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 111 |   2022 | Fecha de Corte                         |  1          | 1            | True     |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 112 |   2022 | Total de activos (Assets)              |  0.319316   | 3.02768e-91  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 113 |   2022 | Total pasivos (Liabilities)            |  0.315395   | 2.22692e-91  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 114 |   2022 | Razón corriente                        |  0.00624203 | 3.38985e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 115 |   2022 | Rotación inventario producto terminado |  0.0319732  | 3.97444e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 116 |   2022 | Rotación cartera                       |  0.00538771 | 8.34447e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 117 |   2022 | Rotación proveedores                   |  0.0130163  | 1.38372e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 118 |   2022 | Productividad KTNO                     |  0.0057774  | 8.5294e-100  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 119 |   2022 | ROA                                    |  0.242589   | 9.63532e-94  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 120 |   2022 | ROE                                    |  0.0160745  | 5.26172e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 121 |   2022 | Nivel de endeudamiento                 |  0.0230423  | 7.83365e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 122 |   2022 | Generación Efectivo                    |  0.00310249 | 2.69208e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 123 |   2022 | FLC                                    |  0.232565   | 4.72152e-94  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 124 |   2022 | FDC/FLC                                |  0.0335217  | 1.43202e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 125 |   2022 | SD                                     |  0.182609   | 1.5169e-95   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 126 |   2022 | FDC                                    |  0.22674    | 3.13097e-94  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 127 |   2022 | Generación FLC                         |  0.00266873 | 2.62717e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 128 |   2022 | Tasa de Desempleo                      |  0.798847   | 5.52147e-65  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 129 |   2022 | Tasa de Ocupación                      |  0.896073   | 9.27372e-52  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 130 |   2022 | PIB                                    |  0.832884   | 1.32028e-61  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 131 |   2022 | PIB DEP                                |  0.843959   | 2.60465e-60  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 132 |   2023 | Cantidad de años de la empresa         |  0.918736   | 2.0717e-48   | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 133 |   2023 | Fecha de Corte                         |  1          | 1            | True     |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 134 |   2023 | Total de activos (Assets)              |  0.120208   | 7.02022e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 135 |   2023 | Total pasivos (Liabilities)            |  0.137481   | 2.09037e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 136 |   2023 | Razón corriente                        |  0.03458    | 4.54813e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 137 |   2023 | Rotación inventario producto terminado |  0.0101648  | 1.61155e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 138 |   2023 | Rotación cartera                       |  0.0147985  | 3.43488e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 139 |   2023 | Rotación proveedores                   |  0.00660775 | 1.32559e-95  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 140 |   2023 | Productividad KTNO                     |  0.0223295  | 5.26711e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 141 |   2023 | ROA                                    |  0.146801   | 3.79643e-96  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 142 |   2023 | ROE                                    |  0.00349854 | 6.95505e-100 | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 143 |   2023 | Nivel de endeudamiento                 |  0.581555   | 6.27323e-80  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 144 |   2023 | Generación Efectivo                    |  0.022271   | 2.14865e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 145 |   2023 | FLC                                    |  0.215348   | 3.67431e-94  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 146 |   2023 | FDC/FLC                                |  0.0104326  | 1.02786e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 147 |   2023 | SD                                     |  0.104324   | 2.61638e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 148 |   2023 | FDC                                    |  0.122596   | 8.15396e-97  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 149 |   2023 | Generación FLC                         |  0.0166963  | 1.56418e-99  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 150 |   2023 | Tasa de Desempleo                      |  0.803436   | 3.53648e-64  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 151 |   2023 | Tasa de Ocupación                      |  0.894839   | 9.03552e-52  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 152 |   2023 | PIB                                    |  0.836475   | 7.08707e-61  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
| 153 |   2023 | PIB DEP                                |  0.847313   | 1.37149e-59  | False    |
+-----+--------+----------------------------------------+-------------+--------------+----------+
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: Input data has range zero. The results may not be accurate.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5276.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5278.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5271.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5197.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5273.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5236.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5277.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5829.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5832.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5018.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5751.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5831.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5789.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5488.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5888.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5895.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5880.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5059.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5788.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5844.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5530.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5909.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5910.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5899.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5008.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5811.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5904.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5856.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5549.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5815.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5818.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5808.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5730.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5812.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5757.
  res = hypotest_fun_out(*samples, **kwds)
/usr/local/lib/python3.10/dist-packages/scipy/stats/_axis_nan_policy.py:531: UserWarning: scipy.stats.shapiro: For N &gt; 5000, computed p-value may not be accurate. Current N is 5491.
  res = hypotest_fun_out(*samples, **kwds)
</pre></div>
</div>
</div>
</div>
<p>El código realiza una prueba de normalidad Shapiro-Wilk para las variables numéricas del conjunto de datos, evaluando su distribución año a año. Los resultados muestran que la mayoría de las variables no siguen una distribución normal (p-valor &lt; 0.05), excepto algunas excepciones como “Fecha de Corte”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">missing_data_percentage</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">columns_to_impute_iteratively</span> <span class="o">=</span> <span class="n">missing_data_percentage</span><span class="p">[</span><span class="n">missing_data_percentage</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

<span class="n">iterative_imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">data_iteratively_imputed</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_iteratively_imputed</span><span class="p">[</span><span class="n">columns_to_impute_iteratively</span><span class="p">]</span> <span class="o">=</span> <span class="n">iterative_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">columns_to_impute_iteratively</span><span class="p">])</span>

<span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">numeric_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_cols</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columns_to_impute_iteratively</span><span class="p">:</span>
        <span class="n">data_iteratively_imputed</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">numeric_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_iteratively_imputed</span><span class="p">[[</span><span class="n">col</span><span class="p">]])</span>

<span class="n">categorical_cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">categorical_cols</span><span class="p">:</span>
    <span class="n">data_iteratively_imputed</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">categorical_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data_iteratively_imputed</span><span class="p">[[</span><span class="n">col</span><span class="p">]])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">data_iteratively_imputed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-44d80d94-f4a3-4a18-adb0-f292ce515d5e" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Estado actual</th>
      <th>NIT</th>
      <th>Concepto del Revisor fiscal en su orme</th>
      <th>La compañía está obligada a tener Revisor fiscal?</th>
      <th>Tipo societario</th>
      <th>Cantidad de años de la empresa</th>
      <th>Departamento de la dirección del domicilio</th>
      <th>Fecha de Corte</th>
      <th>Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)</th>
      <th>Total de activos (Assets)</th>
      <th>...</th>
      <th>Generación Efectivo</th>
      <th>FLC</th>
      <th>FDC/FLC</th>
      <th>SD</th>
      <th>FDC</th>
      <th>Generación FLC</th>
      <th>Tasa de Desempleo</th>
      <th>Tasa de Ocupación</th>
      <th>PIB</th>
      <th>PIB DEP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>ACTIVA</td>
      <td>800000313</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS</td>
      <td>30.0</td>
      <td>BOGOTA D.C.</td>
      <td>2017.0</td>
      <td>Industrias manufactureras.</td>
      <td>4973845.0</td>
      <td>...</td>
      <td>-18.713938</td>
      <td>-134970.0</td>
      <td>1.852263</td>
      <td>115030.0</td>
      <td>-250000.0</td>
      <td>-10.962476</td>
      <td>8.729730</td>
      <td>173.337730</td>
      <td>19523.998522</td>
      <td>212289.141969</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ACTIVA</td>
      <td>800000439</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>03. SOCIEDAD LIMITADA</td>
      <td>30.0</td>
      <td>CUNDINAMARCA</td>
      <td>2017.0</td>
      <td>Comercio al por mayor y al por menor; reparaci...</td>
      <td>2969939.0</td>
      <td>...</td>
      <td>-1.449247</td>
      <td>-81721.0</td>
      <td>5.966667</td>
      <td>405881.0</td>
      <td>-487602.0</td>
      <td>-0.438714</td>
      <td>8.729730</td>
      <td>227.644906</td>
      <td>8523.010078</td>
      <td>49985.621838</td>
    </tr>
    <tr>
      <th>12</th>
      <td>ACTIVA</td>
      <td>800001354</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>03. SOCIEDAD LIMITADA</td>
      <td>30.0</td>
      <td>VALLE</td>
      <td>2017.0</td>
      <td>Agricultura, ganadería, caza, silvicultura y p...</td>
      <td>3681964.0</td>
      <td>...</td>
      <td>-0.277214</td>
      <td>-7482.0</td>
      <td>9.413258</td>
      <td>62948.0</td>
      <td>-70430.0</td>
      <td>-0.026169</td>
      <td>12.470025</td>
      <td>177.129542</td>
      <td>5278.321438</td>
      <td>80979.088539</td>
    </tr>
    <tr>
      <th>13</th>
      <td>ACTIVA</td>
      <td>800001650</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>01. SOCIEDAD ANÓNIMA</td>
      <td>30.0</td>
      <td>BOGOTA D.C.</td>
      <td>2017.0</td>
      <td>Industrias manufactureras.</td>
      <td>5321774.0</td>
      <td>...</td>
      <td>0.003630</td>
      <td>-287013.0</td>
      <td>4.870211</td>
      <td>1110801.0</td>
      <td>-1397814.0</td>
      <td>0.426621</td>
      <td>8.729730</td>
      <td>173.337730</td>
      <td>19523.998522</td>
      <td>212289.141969</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ACTIVA</td>
      <td>800002143</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>01. SOCIEDAD ANÓNIMA</td>
      <td>30.0</td>
      <td>BOGOTA D.C.</td>
      <td>2017.0</td>
      <td>Educación.</td>
      <td>33325095.0</td>
      <td>...</td>
      <td>-1.020946</td>
      <td>1095387.0</td>
      <td>0.168059</td>
      <td>911297.0</td>
      <td>184090.0</td>
      <td>0.702951</td>
      <td>8.729730</td>
      <td>35.867000</td>
      <td>45398.187203</td>
      <td>212289.141969</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>141588</th>
      <td>ACTIVA</td>
      <td>901507911</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS</td>
      <td>2.0</td>
      <td>BOGOTA D.C.</td>
      <td>2023.0</td>
      <td>Información y comunicaciones.</td>
      <td>33572384.0</td>
      <td>...</td>
      <td>-3.736879</td>
      <td>10175953.0</td>
      <td>0.542967</td>
      <td>4650745.0</td>
      <td>5525208.0</td>
      <td>35.010177</td>
      <td>10.809170</td>
      <td>37.910000</td>
      <td>124683.823762</td>
      <td>345847.243838</td>
    </tr>
    <tr>
      <th>141589</th>
      <td>ACTIVA</td>
      <td>901508416</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS</td>
      <td>2.0</td>
      <td>BOGOTA D.C.</td>
      <td>2023.0</td>
      <td>Actividades financieras y de seguros.</td>
      <td>57158795.0</td>
      <td>...</td>
      <td>-1.066927</td>
      <td>-18967864.0</td>
      <td>1.074327</td>
      <td>1409816.0</td>
      <td>-20377680.0</td>
      <td>3.008769</td>
      <td>10.809170</td>
      <td>26.569000</td>
      <td>124683.823762</td>
      <td>345847.243838</td>
    </tr>
    <tr>
      <th>141602</th>
      <td>ACTIVA</td>
      <td>901543555</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS</td>
      <td>2.0</td>
      <td>BOGOTA D.C.</td>
      <td>2023.0</td>
      <td>Comercio al por mayor y al por menor; reparaci...</td>
      <td>67733493.0</td>
      <td>...</td>
      <td>1.710137</td>
      <td>17902743.0</td>
      <td>0.913401</td>
      <td>1550360.0</td>
      <td>16352383.0</td>
      <td>1.872274</td>
      <td>10.809170</td>
      <td>242.903000</td>
      <td>89151.175250</td>
      <td>345847.243838</td>
    </tr>
    <tr>
      <th>141604</th>
      <td>ACTIVA</td>
      <td>901547742</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS</td>
      <td>2.0</td>
      <td>ATLANTICO</td>
      <td>2023.0</td>
      <td>Actividades inmobiliarias.</td>
      <td>9403339.0</td>
      <td>...</td>
      <td>0.412770</td>
      <td>106745.0</td>
      <td>-1.199822</td>
      <td>234820.0</td>
      <td>-128075.0</td>
      <td>0.624927</td>
      <td>9.120440</td>
      <td>16.814000</td>
      <td>13173.250881</td>
      <td>62967.702340</td>
    </tr>
    <tr>
      <th>141612</th>
      <td>ACTIVA</td>
      <td>901626193</td>
      <td>03. LIMPIO</td>
      <td>SI</td>
      <td>08. SOCIEDAD POR ACCIONES SIMPLIFICADA SAS</td>
      <td>1.0</td>
      <td>SANTANDER</td>
      <td>2023.0</td>
      <td>Actividades inmobiliarias.</td>
      <td>70591661.0</td>
      <td>...</td>
      <td>-1.272115</td>
      <td>1236895.0</td>
      <td>0.354595</td>
      <td>798298.0</td>
      <td>438597.0</td>
      <td>1.111030</td>
      <td>10.504223</td>
      <td>12.753000</td>
      <td>15070.176883</td>
      <td>84320.235264</td>
    </tr>
  </tbody>
</table>
<p>37168 rows × 29 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-44d80d94-f4a3-4a18-adb0-f292ce515d5e')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-44d80d94-f4a3-4a18-adb0-f292ce515d5e button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-44d80d94-f4a3-4a18-adb0-f292ce515d5e');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-81533517-01da-4675-9807-2e4fa16885e6">
  <button class="colab-df-quickchart" onclick="quickchart('df-81533517-01da-4675-9807-2e4fa16885e6')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-81533517-01da-4675-9807-2e4fa16885e6 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_2465eb33-501c-44ba-b97e-f6b05404d551">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('data_iteratively_imputed')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_2465eb33-501c-44ba-b97e-f6b05404d551 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('data_iteratively_imputed');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<p>Esta ya seria el dataset con los datos imputados</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_missing_data_heatmap</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots a heatmap of missing data for each year.&quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">year_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
        <span class="n">missing_percentage</span> <span class="o">=</span> <span class="n">year_data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">missing_percentage</span> <span class="o">=</span> <span class="n">missing_percentage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">missing_percentage</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Missing Percentage&#39;</span><span class="p">})</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing Data Heatmap for Year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Column&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>  
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_missing_data_heatmap</span><span class="p">(</span><span class="n">data_iteratively_imputed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dd54e32698ff715829c36e9ee9b70235ad202daa29ca8c56c9c8916a05e813db.png" src="_images/dd54e32698ff715829c36e9ee9b70235ad202daa29ca8c56c9c8916a05e813db.png" />
<img alt="_images/c60dbac1b00f8b5d79038dddd15f2704a160db92351860fbbb52f1282e6e4329.png" src="_images/c60dbac1b00f8b5d79038dddd15f2704a160db92351860fbbb52f1282e6e4329.png" />
<img alt="_images/b58655e99e3ee789194a525cc06c53d9cf5732ab7cc527d1ce4f9975851b1f20.png" src="_images/b58655e99e3ee789194a525cc06c53d9cf5732ab7cc527d1ce4f9975851b1f20.png" />
<img alt="_images/4a2957096b1caa09f81666f27009f3175038e140a4067d236d30d19a37f67d77.png" src="_images/4a2957096b1caa09f81666f27009f3175038e140a4067d236d30d19a37f67d77.png" />
<img alt="_images/83772af1ed5dd341998e8578105934a2bf6c03422bdf0a4b6627484b90047b14.png" src="_images/83772af1ed5dd341998e8578105934a2bf6c03422bdf0a4b6627484b90047b14.png" />
<img alt="_images/1e690364d11ddf957bfdb25ce08acb9269c7cd869af6823f640bee887ec2af2c.png" src="_images/1e690364d11ddf957bfdb25ce08acb9269c7cd869af6823f640bee887ec2af2c.png" />
<img alt="_images/04547e45117756c14e2fe344cf88abc53607e60def93314e7c87cd67bbc19c0f.png" src="_images/04547e45117756c14e2fe344cf88abc53607e60def93314e7c87cd67bbc19c0f.png" />
</div>
</div>
<p>La función que genera mapas de calor iterativos para visualizar el porcentaje de datos faltantes en cada columna del conjunto de datos, año por año, basado en la variable Fecha de Corte. La función calcula el porcentaje de datos faltantes para cada columna, lo organiza de mayor a menor y genera un gráfico para cada año. Los gráficos proporcionan una visión clara de cómo varían los datos faltantes en las columnas a lo largo de los años. En el ejemplo mostrado, el porcentaje de datos faltantes para el año 2017 es prácticamente inexistente (0%), y asi para todos los años. Indicando que se imputaron todos los datos faltantes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compare_distributions</span><span class="p">(</span><span class="n">original_data</span><span class="p">,</span> <span class="n">imputed_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
    <span class="n">statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">ks_2samp</span><span class="p">(</span><span class="n">original_data</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">imputed_data</span><span class="p">[</span><span class="n">column_name</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;statistic&quot;</span><span class="p">:</span> <span class="n">statistic</span><span class="p">,</span> <span class="s2">&quot;p_value&quot;</span><span class="p">:</span> <span class="n">p_value</span><span class="p">}</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numericos</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
  <span class="n">comparison_results</span> <span class="o">=</span> <span class="n">compare_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_iteratively_imputed</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Kolmogorov-Smirnov test for </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Statistic: </span><span class="si">{</span><span class="n">comparison_results</span><span class="p">[</span><span class="s1">&#39;statistic&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  P-value: </span><span class="si">{</span><span class="n">comparison_results</span><span class="p">[</span><span class="s1">&#39;p_value&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

  <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
  <span class="k">if</span> <span class="n">comparison_results</span><span class="p">[</span><span class="s2">&quot;p_value&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  The distributions of </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> are significantly different after imputation.&quot;</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  The distributions of </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> are not significantly different after imputation.&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Kolmogorov-Smirnov test for Cantidad de años de la empresa:
  Statistic: 0.000
  P-value: 1.000
  The distributions of Cantidad de años de la empresa are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Fecha de Corte:
  Statistic: 0.000
  P-value: 1.000
  The distributions of Fecha de Corte are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Total de activos (Assets):
  Statistic: 0.000
  P-value: 1.000
  The distributions of Total de activos (Assets) are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Total pasivos (Liabilities):
  Statistic: 0.000
  P-value: 1.000
  The distributions of Total pasivos (Liabilities) are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Razón corriente:
  Statistic: 0.001
  P-value: 1.000
  The distributions of Razón corriente are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Rotación inventario producto terminado:
  Statistic: 0.143
  P-value: 0.000
  The distributions of Rotación inventario producto terminado are significantly different after imputation.
---
Kolmogorov-Smirnov test for Rotación cartera:
  Statistic: 0.008
  P-value: 0.192
  The distributions of Rotación cartera are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Rotación proveedores:
  Statistic: 0.142
  P-value: 0.000
  The distributions of Rotación proveedores are significantly different after imputation.
---
Kolmogorov-Smirnov test for Productividad KTNO:
  Statistic: 0.008
  P-value: 0.192
  The distributions of Productividad KTNO are not significantly different after imputation.
---
Kolmogorov-Smirnov test for ROA:
  Statistic: 0.000
  P-value: 1.000
  The distributions of ROA are not significantly different after imputation.
---
Kolmogorov-Smirnov test for ROE:
  Statistic: 0.000
  P-value: 1.000
  The distributions of ROE are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Nivel de endeudamiento:
  Statistic: 0.000
  P-value: 1.000
  The distributions of Nivel de endeudamiento are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Generación Efectivo:
  Statistic: 0.000
  P-value: 1.000
  The distributions of Generación Efectivo are not significantly different after imputation.
---
Kolmogorov-Smirnov test for FLC:
  Statistic: 0.000
  P-value: 1.000
  The distributions of FLC are not significantly different after imputation.
---
Kolmogorov-Smirnov test for FDC/FLC:
  Statistic: 0.000
  P-value: 1.000
  The distributions of FDC/FLC are not significantly different after imputation.
---
Kolmogorov-Smirnov test for SD:
  Statistic: 0.000
  P-value: 1.000
  The distributions of SD are not significantly different after imputation.
---
Kolmogorov-Smirnov test for FDC:
  Statistic: 0.000
  P-value: 1.000
  The distributions of FDC are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Generación FLC:
  Statistic: 0.000
  P-value: 1.000
  The distributions of Generación FLC are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Tasa de Desempleo:
  Statistic: 0.004
  P-value: 0.910
  The distributions of Tasa de Desempleo are not significantly different after imputation.
---
Kolmogorov-Smirnov test for Tasa de Ocupación:
  Statistic: 0.034
  P-value: 0.000
  The distributions of Tasa de Ocupación are significantly different after imputation.
---
Kolmogorov-Smirnov test for PIB:
  Statistic: 0.000
  P-value: 1.000
  The distributions of PIB are not significantly different after imputation.
---
Kolmogorov-Smirnov test for PIB DEP:
  Statistic: 0.000
  P-value: 1.000
  The distributions of PIB DEP are not significantly different after imputation.
---
</pre></div>
</div>
</div>
</div>
<p>El código utiliza la prueba de Kolmogorov-Smirnov para comparar las distribuciones de las variables numéricas antes y después de la imputación de datos faltantes, verificando si esta alteró significativamente su estructura estadística. La prueba evalúa la diferencia entre las distribuciones mediante un estadístico y un p-valor, donde un p-valor mayor a 0.05 indica que las distribuciones originales e imputadas no son significativamente diferentes.</p>
<section id="verificar-vif">
<h3>Verificar VIF<a class="headerlink" href="#verificar-vif" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_vars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">,</span> <span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">,</span> <span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span>
<span class="n">numeric_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">numeric_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_vars</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_vif</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
    <span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;Variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">vif_data</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">vif_data</span>

<span class="n">features</span> <span class="o">=</span> <span class="n">numeric_vars</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">iteration</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Iteración </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">vif_df</span> <span class="o">=</span> <span class="n">calculate_vif</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">vif_df</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">vif_df</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No hay variables con VIF &gt; 10. Se detiene la iteración.&quot;</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_vif_feature</span> <span class="o">=</span> <span class="n">vif_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">vif_df</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s1">&#39;Variable&#39;</span><span class="p">]</span>
        <span class="n">max_vif_value</span> <span class="o">=</span> <span class="n">vif_df</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Eliminando variable &#39;</span><span class="si">{</span><span class="n">max_vif_feature</span><span class="si">}</span><span class="s2">&#39; con VIF = </span><span class="si">{</span><span class="n">max_vif_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">features</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">max_vif_feature</span><span class="p">)</span>
        <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Conjunto final de variables después de eliminar multicolinealidad:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iteración 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/statsmodels/stats/outliers_influence.py:197: RuntimeWarning: divide by zero encountered in scalar divide
  vif = 1. / (1. - r_squared_i)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                  Variable           VIF
0           Cantidad de años de la empresa  3.310142e+00
1                Total de activos (Assets)  8.219144e+00
2              Total pasivos (Liabilities)  7.026376e+00
3                          Razón corriente  1.001332e+00
4   Rotación inventario producto terminado  9.198095e+03
5                         Rotación cartera  1.729316e+03
6                     Rotación proveedores  1.973792e+02
7                       Productividad KTNO  1.491872e+04
8                                      ROA  1.685206e+00
9                                      ROE  1.000548e+00
10                  Nivel de endeudamiento  3.696967e+00
11                     Generación Efectivo  1.486128e+01
12                                     FLC           inf
13                                 FDC/FLC  1.000306e+00
14                                      SD           inf
15                                     FDC           inf
16                          Generación FLC  1.486185e+01
17                       Tasa de Desempleo  5.590192e+00
18                       Tasa de Ocupación  2.983366e+00
19                                     PIB  4.055884e+00
20                                 PIB DEP  6.960477e+00
Eliminando variable &#39;FLC&#39; con VIF = inf

Iteración 2
                                  Variable           VIF
0           Cantidad de años de la empresa      3.310142
1                Total de activos (Assets)      8.219144
2              Total pasivos (Liabilities)      7.026376
3                          Razón corriente      1.001332
4   Rotación inventario producto terminado   9198.095249
5                         Rotación cartera   1729.316111
6                     Rotación proveedores    197.379191
7                       Productividad KTNO  14918.718115
8                                      ROA      1.685206
9                                      ROE      1.000548
10                  Nivel de endeudamiento      3.696967
11                     Generación Efectivo     14.861282
12                                 FDC/FLC      1.000306
13                                      SD      1.544904
14                                     FDC      1.275107
15                          Generación FLC     14.861846
16                       Tasa de Desempleo      5.590192
17                       Tasa de Ocupación      2.983366
18                                     PIB      4.055884
19                                 PIB DEP      6.960477
Eliminando variable &#39;Productividad KTNO&#39; con VIF = 14918.7181145412

Iteración 3
                                  Variable        VIF
0           Cantidad de años de la empresa   3.310065
1                Total de activos (Assets)   8.218138
2              Total pasivos (Liabilities)   7.024391
3                          Razón corriente   1.001332
4   Rotación inventario producto terminado  24.563633
5                         Rotación cartera   6.658252
6                     Rotación proveedores  17.306405
7                                      ROA   1.609115
8                                      ROE   1.000525
9                   Nivel de endeudamiento   3.646981
10                     Generación Efectivo  14.861281
11                                 FDC/FLC   1.000305
12                                      SD   1.544903
13                                     FDC   1.275098
14                          Generación FLC  14.861844
15                       Tasa de Desempleo   5.569999
16                       Tasa de Ocupación   2.979928
17                                     PIB   4.055778
18                                 PIB DEP   6.960432
Eliminando variable &#39;Rotación inventario producto terminado&#39; con VIF = 24.5636329697905

Iteración 4
                          Variable        VIF
0   Cantidad de años de la empresa   3.309955
1        Total de activos (Assets)   8.218100
2      Total pasivos (Liabilities)   7.024290
3                  Razón corriente   1.001331
4                 Rotación cartera   4.657764
5             Rotación proveedores   4.656228
6                              ROA   1.607671
7                              ROE   1.000525
8           Nivel de endeudamiento   3.645827
9              Generación Efectivo  14.861281
10                         FDC/FLC   1.000305
11                              SD   1.544902
12                             FDC   1.275096
13                  Generación FLC  14.861844
14               Tasa de Desempleo   5.568998
15               Tasa de Ocupación   2.979822
16                             PIB   4.055757
17                         PIB DEP   6.960429
Eliminando variable &#39;Generación FLC&#39; con VIF = 14.861844369402986

Iteración 5
                          Variable       VIF
0   Cantidad de años de la empresa  3.309949
1        Total de activos (Assets)  8.217899
2      Total pasivos (Liabilities)  7.023550
3                  Razón corriente  1.001331
4                 Rotación cartera  4.657764
5             Rotación proveedores  4.656228
6                              ROA  1.607669
7                              ROE  1.000525
8           Nivel de endeudamiento  3.645812
9              Generación Efectivo  1.000089
10                         FDC/FLC  1.000305
11                              SD  1.544677
12                             FDC  1.274828
13               Tasa de Desempleo  5.568947
14               Tasa de Ocupación  2.979821
15                             PIB  4.055739
16                         PIB DEP  6.960143

No hay variables con VIF &gt; 10. Se detiene la iteración.

Conjunto final de variables después de eliminar multicolinealidad:
[&#39;Cantidad de años de la empresa&#39;, &#39;Total de activos (Assets)&#39;, &#39;Total pasivos (Liabilities)&#39;, &#39;Razón corriente&#39;, &#39;Rotación cartera&#39;, &#39;Rotación proveedores&#39;, &#39;ROA&#39;, &#39;ROE&#39;, &#39;Nivel de endeudamiento&#39;, &#39;Generación Efectivo&#39;, &#39;FDC/FLC&#39;, &#39;SD&#39;, &#39;FDC&#39;, &#39;Tasa de Desempleo&#39;, &#39;Tasa de Ocupación&#39;, &#39;PIB&#39;, &#39;PIB DEP&#39;]
</pre></div>
</div>
</div>
</div>
<p>Factor de Inflación de la Varianza (VIF) y eliminar variables con alta multicolinealidad (VIF &gt; 10), asegurando un conjunto de características más independientes y adecuadas para el modelado. El VIF evalúa cuánto aumenta la varianza de un coeficiente de regresión debido a la multicolinealidad; valores altos indican redundancia entre variables. En este caso, se identificaron y eliminaron variables como “FLC” debido a su colinealidad perfecta (VIF infinito).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seleccionar solo las variables numéricas</span>
<span class="n">numeric_df</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>

<span class="c1"># Calcular la matriz de correlación</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">numeric_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Plotear la matriz de correlación</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Matriz de Correlación de Variables Numéricas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/32b07289235e3ae2c7041240c90d6a7e1d20555d52bf6766439ae4e631c41d50.png" src="_images/32b07289235e3ae2c7041240c90d6a7e1d20555d52bf6766439ae4e631c41d50.png" />
</div>
</div>
<p>Generamos una matriz de correlación para las variables numéricas, representada mediante un mapa de calor, lo que permite identificar relaciones lineales entre variables. La matriz revela correlaciones fuertes, como la positiva entre “Total de activos (Assets)” y “Total pasivos (Liabilities)” (0.89), lo que indica que estas variables están altamente relacionadas. También se observa una correlación negativa significativa entre “ROE” y “Nivel de endeudamiento” (-0.93), reflejando la influencia del apalancamiento sobre la rentabilidad. Este análisis es clave para detectar colinealidad y redundancia entre las variables.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelamiento">
<h1>Modelamiento<a class="headerlink" href="#modelamiento" title="Link to this heading">#</a></h1>
<p>Observar las variables restantes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">variables_to_keep</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cantidad de años de la empresa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total de activos (Assets)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total pasivos (Liabilities)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Razón corriente&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación cartera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación proveedores&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nivel de endeudamiento&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Generación Efectivo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC/FLC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Desempleo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Ocupación&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB DEP&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NIT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC_FLC_categoria&#39;</span>
<span class="p">]</span>

<span class="c1"># Filtrar variables seleccionadas y categóricas</span>
<span class="n">filtered_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">variables_to_keep</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="o">~</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Cantidad de años de la empresa&#39;, &#39;Fecha de Corte&#39;, &#39;Total de activos (Assets)&#39;, &#39;Total pasivos (Liabilities)&#39;, &#39;Razón corriente&#39;, &#39;Rotación cartera&#39;, &#39;Rotación proveedores&#39;, &#39;ROA&#39;, &#39;ROE&#39;, &#39;Nivel de endeudamiento&#39;, &#39;Generación Efectivo&#39;, &#39;FDC/FLC&#39;, &#39;SD&#39;, &#39;FDC&#39;, &#39;Tasa de Desempleo&#39;, &#39;Tasa de Ocupación&#39;, &#39;PIB&#39;, &#39;PIB DEP&#39;, &#39;NIT&#39;, &#39;FDC_FLC_categoria&#39;, &#39;Estado actual&#39;, &#39;Concepto del Revisor fiscal en su orme&#39;, &#39;La compañía está obligada a tener Revisor fiscal?&#39;, &#39;Tipo societario&#39;, &#39;Departamento de la dirección del domicilio&#39;, &#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;]
</pre></div>
</div>
</div>
</div>
<p>Listar los nombres de las columnas presentes en el conjunto de datos después de aplicar el filtrado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">variabletypes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">variabletypes</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Data Type&#39;</span><span class="p">,</span> <span class="s1">&#39;Count&#39;</span><span class="p">]</span>

<span class="n">variabletypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="df-a6a57763-e384-402c-911a-acfcfe928ae2" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Data Type</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>float64</td>
      <td>17</td>
    </tr>
    <tr>
      <th>1</th>
      <td>object</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>int64</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>category</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-a6a57763-e384-402c-911a-acfcfe928ae2')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-a6a57763-e384-402c-911a-acfcfe928ae2 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-a6a57763-e384-402c-911a-acfcfe928ae2');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-6a63d827-78bd-4a8b-9505-89b57460ccbc">
  <button class="colab-df-quickchart" onclick="quickchart('df-6a63d827-78bd-4a8b-9505-89b57460ccbc')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-6a63d827-78bd-4a8b-9505-89b57460ccbc button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_74e2953d-b0eb-4e59-9407-a459f34ce0ec">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('variabletypes')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_74e2953d-b0eb-4e59-9407-a459f34ce0ec button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('variabletypes');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div></div>
</div>
<p>Resumen de los tipos de datos presentes en el conjunto de datos filtrado, indicando que contiene 17 variables numéricas de tipo float64, 7 variables categóricas de tipo object, 1 variable de tipo entero (int64) y 1 variable categórica (category).</p>
<section id="modelo-de-regresion-logistica-multinomial">
<h2>Modelo de regresión logística Multinomial<a class="headerlink" href="#modelo-de-regresion-logistica-multinomial" title="Link to this heading">#</a></h2>
<p><strong>Supuestos:</strong></p>
<p>La regresión logística multinomial tiene varios supuestos:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Independencia</span> <span class="pre">de</span> <span class="pre">las</span> <span class="pre">observaciones:</span></code> Las observaciones deben ser independientes entre sí.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">multicolinealidad:</span></code> Las variables independientes no deben estar altamente correlacionadas.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Linealidad</span> <span class="pre">en</span> <span class="pre">el</span> <span class="pre">logit:</span></code> Relación lineal entre las variables independientes continuas y el logit de la variable dependiente.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Independencia</span> <span class="pre">de</span> <span class="pre">alternativas</span> <span class="pre">irrelevantes</span> <span class="pre">(IIA):</span></code> La elección entre dos categorías no debe verse afectada por la introducción o eliminación de otras categorías.</p></li>
</ul>
<p>En datos de panel, el supuesto de independencia de las observaciones se viola porque tenemos múltiples observaciones para cada empresa a lo largo del tiempo. Esto introduce correlación intra-grupo.</p>
<p><strong>Preparación de los datos</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">numeric_vars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">category_vars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">object_vars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">categorical_vars</span> <span class="o">=</span> <span class="n">category_vars</span> <span class="o">+</span> <span class="n">object_vars</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables numéricas:&quot;</span><span class="p">,</span> <span class="n">numeric_vars</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables categóricas:&quot;</span><span class="p">,</span> <span class="n">categorical_vars</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables numéricas: [&#39;Cantidad de años de la empresa&#39;, &#39;Fecha de Corte&#39;, &#39;Total de activos (Assets)&#39;, &#39;Total pasivos (Liabilities)&#39;, &#39;Razón corriente&#39;, &#39;Rotación cartera&#39;, &#39;Rotación proveedores&#39;, &#39;ROA&#39;, &#39;ROE&#39;, &#39;Nivel de endeudamiento&#39;, &#39;Generación Efectivo&#39;, &#39;FDC/FLC&#39;, &#39;SD&#39;, &#39;FDC&#39;, &#39;Tasa de Desempleo&#39;, &#39;Tasa de Ocupación&#39;, &#39;PIB&#39;, &#39;PIB DEP&#39;]
Variables categóricas: [&#39;FDC_FLC_categoria&#39;, &#39;NIT&#39;, &#39;Estado actual&#39;, &#39;Concepto del Revisor fiscal en su orme&#39;, &#39;La compañía está obligada a tener Revisor fiscal?&#39;, &#39;Tipo societario&#39;, &#39;Departamento de la dirección del domicilio&#39;, &#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Años disponibles en el dataset:&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Años disponibles en el dataset: [2017 2018 2019 2020 2021 2022 2023]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Codificar la variable objetivo</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
</pre></div>
</div>
</div>
</div>
<p>El código transforma la variable categórica ‘FDC_FLC_categoria’ en una variable numérica denominada ‘FDC_FLC_categoria_code’, asignando códigos enteros únicos a cada categoría mediante .cat.codes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Excluir variables no necesarias</span>
<span class="n">exclude_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">,</span> <span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">,</span> <span class="s1">&#39;NIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">,</span> <span class="s1">&#39;FDC/FLC&#39;</span><span class="p">]</span>

<span class="c1"># Variables numéricas finales para el modelo</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">numeric_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_vars</span><span class="p">]</span>

<span class="c1"># Variables categóricas finales para el modelo</span>
<span class="n">model_categorical_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_vars</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>El código filtra las variables finales para el modelo excluyendo aquellas no relevantes, como <code class="docutils literal notranslate"><span class="pre">FDC_FLC_categoria</span></code> y su versión codificada (<code class="docutils literal notranslate"><span class="pre">FDC_FLC_categoria_code</span></code>), <code class="docutils literal notranslate"><span class="pre">NIT</span></code>, <code class="docutils literal notranslate"><span class="pre">Fecha</span> <span class="pre">de</span> <span class="pre">Corte</span></code> y <code class="docutils literal notranslate"><span class="pre">FDC/FLC</span></code>, que no aportan valor predictivo o introducen redundancias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables numéricas utilizadas en el modelo:&quot;</span><span class="p">,</span> <span class="n">model_numeric_vars</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables categóricas utilizadas en el modelo:&quot;</span><span class="p">,</span> <span class="n">model_categorical_vars</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables numéricas utilizadas en el modelo: [&#39;Cantidad de años de la empresa&#39;, &#39;Total de activos (Assets)&#39;, &#39;Total pasivos (Liabilities)&#39;, &#39;Razón corriente&#39;, &#39;Rotación cartera&#39;, &#39;Rotación proveedores&#39;, &#39;ROA&#39;, &#39;ROE&#39;, &#39;Nivel de endeudamiento&#39;, &#39;Generación Efectivo&#39;, &#39;SD&#39;, &#39;FDC&#39;, &#39;Tasa de Desempleo&#39;, &#39;Tasa de Ocupación&#39;, &#39;PIB&#39;, &#39;PIB DEP&#39;]
Variables categóricas utilizadas en el modelo: [&#39;Estado actual&#39;, &#39;Concepto del Revisor fiscal en su orme&#39;, &#39;La compañía está obligada a tener Revisor fiscal?&#39;, &#39;Tipo societario&#39;, &#39;Departamento de la dirección del domicilio&#39;, &#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">available_years</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">time_series_splits</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_years</span><span class="p">)):</span>
    <span class="n">train_years</span> <span class="o">=</span> <span class="n">available_years</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> 
    <span class="n">test_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">available_years</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  
    <span class="n">train_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_years</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">test_indices</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test_years</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">time_series_splits</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">train_indices</span><span class="p">,</span> <span class="n">test_indices</span><span class="p">))</span>


<span class="n">train_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">train_years</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">available_years</span><span class="p">]</span>
<span class="n">test_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">test_years</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">available_years</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dividir los datos</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_years</span><span class="p">)]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">test_years</span><span class="p">)]</span>

<span class="c1"># Verificar el número de muestras</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Número de muestras en el conjunto de entrenamiento:&quot;</span><span class="p">,</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Número de muestras en el conjunto de prueba:&quot;</span><span class="p">,</span> <span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Número de muestras en el conjunto de entrenamiento: 19545
Número de muestras en el conjunto de prueba: 17623
</pre></div>
</div>
</div>
</div>
<p>La division división para series temporales, creando conjuntos de entrenamiento y prueba basados en la variable <code class="docutils literal notranslate"><span class="pre">Fecha</span> <span class="pre">de</span> <span class="pre">Corte</span></code>. El conjunto de entrenamiento incluye los datos de años anteriores al año actual de prueba, mientras que el conjunto de prueba contiene los datos del año seleccionado, respetando la secuencia temporal. Este enfoque evita la contaminación del conjunto de entrenamiento con datos futuros, garantizando evaluaciones más realistas y alineadas con escenarios reales. Además, se verifica el número de muestras en cada conjunto para confirmar que la división se realizó correctamente, preservando la integridad del análisis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variables predictoras</span>
<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>

<span class="n">x</span><span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">model_vars</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verificar valores nulos en X_train</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Valores nulos en X_train:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Valores nulos en X_train:
 Cantidad de años de la empresa                                          0
Total de activos (Assets)                                               0
Total pasivos (Liabilities)                                             0
Razón corriente                                                         0
Rotación cartera                                                        0
Rotación proveedores                                                    0
ROA                                                                     0
ROE                                                                     0
Nivel de endeudamiento                                                  0
Generación Efectivo                                                     0
SD                                                                      0
FDC                                                                     0
Tasa de Desempleo                                                       0
Tasa de Ocupación                                                       0
PIB                                                                     0
PIB DEP                                                                 0
Estado actual                                                           0
Concepto del Revisor fiscal en su orme                                  0
La compañía está obligada a tener Revisor fiscal?                       0
Tipo societario                                                         0
Departamento de la dirección del domicilio                              0
Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)    0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>El código verifica la existencia de valores nulos en el conjunto de entrenamiento (<code class="docutils literal notranslate"><span class="pre">X_train</span></code>) después de seleccionar las variables numéricas y categóricas relevantes para el modelo. La salida confirma que no existen valores nulos en ninguna de las variables incluidas en <code class="docutils literal notranslate"><span class="pre">X_train</span></code>.</p>
<p>Al asegurar que no hay datos faltantes, se confirma que el preprocesamiento y las imputaciones previas se realizaron correctamente. Esto permite avanzar hacia el entrenamiento del modelo con la confianza de que las entradas están completas y listas para ser procesadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">model_numeric_vars</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">model_categorical_vars</span><span class="p">)</span>
    <span class="p">])</span>

<span class="n">pipeline_logreg</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">time_series_splits</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred_logreg</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación en el conjunto de prueba (Regresión Logística Multinomial):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logreg</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación en el conjunto de prueba (Regresión Logística Multinomial):
              precision    recall  f1-score   support

           0       0.82      0.74      0.78      3652
           1       0.60      0.87      0.71      3236
           2       0.12      0.00      0.00       762
           3       0.76      0.48      0.58      1984
           4       0.83      0.91      0.87      4489

    accuracy                           0.75     14123
   macro avg       0.63      0.60      0.59     14123
weighted avg       0.73      0.75      0.72     14123
</pre></div>
</div>
</div>
</div>
<p>Ahora el preprocesamiento de datos y el entrenamiento de un modelo de Regresión Logística Multinomial, utilizando divisiones temporales para entrenar y probar el modelo. El preprocesamiento incluye la estandarización de variables numéricas y la codificación de variables categóricas, asegurando un flujo de datos adecuado. Los resultados muestran un desempeño general con una precisión (accuracy) del 75% en el conjunto de prueba, destacándose un buen rendimiento en las clases <code class="docutils literal notranslate"><span class="pre">0</span></code> y <code class="docutils literal notranslate"><span class="pre">4</span></code>, pero con un desempeño muy bajo en la clase <code class="docutils literal notranslate"><span class="pre">2</span></code> (F1-score de 0.00), indicando dificultades para distinguir esta categoría. Esto sugiere la necesidad de ajustes adicionales, como técnicas de balanceo o ajustes de hiperparámetros, para mejorar la clasificación en las clases menos representadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">label_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mapa de etiquetas numéricas a categorías originales:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">label_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Etiqueta </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mapa de etiquetas numéricas a categorías originales:
Etiqueta 0: &lt;0
Etiqueta 1: [0, 0.67)
Etiqueta 2: [0.67, 0.80)
Etiqueta 3: [0.80, 1)
Etiqueta 4: [1, ∞)
</pre></div>
</div>
</div>
</div>
<p>El mapeo entre etiquetas numéricas y categorías originales proporciona una interpretación clara de los resultados del modelo al asociar las predicciones numéricas con rangos específicos de la variable categórica <code class="docutils literal notranslate"><span class="pre">FDC_FLC_categoria</span></code>. Por ejemplo, la etiqueta <code class="docutils literal notranslate"><span class="pre">0</span></code> representa valores menores a <code class="docutils literal notranslate"><span class="pre">0</span></code>, mientras que las etiquetas restantes corresponden a rangos definidos, como <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67)</span></code> o <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de confusión</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matriz de confusión (Regresión Logística Multinomial):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logreg</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Matriz de confusión (Regresión Logística Multinomial):
[[2693  257    0    6  696]
 [ 177 2822    7  108  122]
 [   4  553    1  191   13]
 [  14 1013    0  944   13]
 [ 395   25    0    0 4069]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logreg</span><span class="p">)</span>

<span class="n">category_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">label_mapping</span><span class="p">))]</span>

<span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">category_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">category_names</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_df</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Matriz de Confusión - Regresión Logística Multinomial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Categoría Verdadera&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Categoría Predicha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/379a5d9fb523eb67401c440ddf688e9e75850ab104dcc9ba812950cb88bc6970.png" src="_images/379a5d9fb523eb67401c440ddf688e9e75850ab104dcc9ba812950cb88bc6970.png" />
</div>
</div>
<p>La matriz de confusión ilustra el desempeño del modelo de Regresión Logística Multinomial, destacando un buen rendimiento en categorías como <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> con altos valores en la diagonal principal (2693 y 4069 predicciones correctas, respectivamente). Sin embargo, se observan errores significativos en categorías intermedias como <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code>, donde muchas observaciones son clasificadas erróneamente como categorías adyacentes, como <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67)</span></code> o <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code>. Esto refleja que el modelo tiene dificultades para diferenciar límites entre estas clases, lo que sugiere la necesidad de ajustes adicionales, como balanceo de clases o una selección más precisa de características, para mejorar la clasificación en estas categorías específicas.</p>
<p>Curvas de ROC</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Binarizar las etiquetas de las clases para ROC</span>
<span class="n">y_test_binarized</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="n">y_test_binarized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Obtener las probabilidades predichas</span>
<span class="n">y_score</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Calcular la curva ROC y el área bajo la curva para cada clase</span>
<span class="n">fpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">tpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">roc_auc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
    <span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_score</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># Graficar las curvas ROC para cada clase</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Clase </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">) - AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Falsos Positivos (False Positive Rate)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Verdaderos Positivos (True Positive Rate)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Curvas ROC Multiclase - Regresión Logística Multinomial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f18996b8c20ad85937bd747af4fec5f9498018321f07d3b8df75f6b00eac03a7.png" src="_images/f18996b8c20ad85937bd747af4fec5f9498018321f07d3b8df75f6b00eac03a7.png" />
</div>
</div>
<p>La gráfica de las curvas ROC multiclase evalúa el desempeño del modelo de Regresión Logística Multinomial al clasificar las diferentes categorías. Cada curva representa la relación entre la tasa de verdaderos positivos (TPR) y la tasa de falsos positivos (FPR) para una clase específica, con su respectivo área bajo la curva (AUC).</p>
<p>Las clases muestran áreas bajo la curva (AUC) que oscilan entre 0.86 y 0.98, destacando un buen desempeño general del modelo. La clase <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> tiene la mayor AUC (0.98), indicando una excelente capacidad del modelo para distinguir esta categoría. En contraste, la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> tiene la AUC más baja (0.86), lo que coincide con los resultados previos que mostraron dificultades para clasificar esta categoría. Las AUC cercanas a 1 reflejan un modelo robusto en la mayoría de las clases.</p>
<p>La visualización de las curvas ROC multiclase permite evaluar la efectividad del modelo para cada clase, mostrando un desempeño sólido en general, pero con oportunidades de mejora en categorías específicas como <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code>. Este análisis reafirma la necesidad de ajustar el modelo para optimizar la discriminación en las clases con menor AUC.</p>
<p>Examinar coeficiente</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>

<span class="n">feature_names</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>

<span class="n">coef_df</span><span class="p">[</span><span class="s1">&#39;Clase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">classes_</span>

<span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Clase&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seleccionar las variables más importantes (por ejemplo, las 10 con mayor coeficiente absoluto)</span>
<span class="k">for</span> <span class="n">clase</span> <span class="ow">in</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="c1"># Obtener los coeficientes absolutos y ordenar</span>
    <span class="n">coef_clase</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clase</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Seleccionar las top 10 variables</span>
    <span class="n">top_features</span> <span class="o">=</span> <span class="n">coef_clase</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
    <span class="n">top_coef</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clase</span><span class="p">,</span> <span class="n">top_features</span><span class="p">]</span>

    <span class="c1"># Plotear</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">top_coef</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Coeficientes para la Clase </span><span class="si">{</span><span class="n">clase</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">clase</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Coeficiente&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dba5ade831549048e9cd2216ee7022da235a615a4e9f6b0480a43ba216def6ba.png" src="_images/dba5ade831549048e9cd2216ee7022da235a615a4e9f6b0480a43ba216def6ba.png" />
<img alt="_images/822ef17c94ce36eb0c8dac26bc35fa0657e0a99938fabe570ffc5087bb054c04.png" src="_images/822ef17c94ce36eb0c8dac26bc35fa0657e0a99938fabe570ffc5087bb054c04.png" />
<img alt="_images/d9820828797245732e54bf242a77336757de2c754251210e9e00eeb62f7a2e6d.png" src="_images/d9820828797245732e54bf242a77336757de2c754251210e9e00eeb62f7a2e6d.png" />
<img alt="_images/e2ca1dc9af24e421ca64f95381d30263224b8a3620636f52c1828043a81c90ac.png" src="_images/e2ca1dc9af24e421ca64f95381d30263224b8a3620636f52c1828043a81c90ac.png" />
<img alt="_images/0f24ba2d1ff77b8f5190451accfa792ee714a242079a2d01ab55ad257ea373c5.png" src="_images/0f24ba2d1ff77b8f5190451accfa792ee714a242079a2d01ab55ad257ea373c5.png" />
</div>
</div>
<p>Las gráficas de coeficientes destacan las 10 variables más influyentes en el modelo de Regresión Logística Multinomial para cada clase, mostrando cómo contribuyen a la probabilidad de clasificación. Variables numéricas como <code class="docutils literal notranslate"><span class="pre">num__SD</span></code> (Servicio de Deuda) y <code class="docutils literal notranslate"><span class="pre">num__FDC</span></code> (Flujo de Caja Directo) son particularmente relevantes en múltiples clases, reflejando su importancia en el desempeño financiero. Además, variables categóricas como <code class="docutils literal notranslate"><span class="pre">cat__Departamento</span> <span class="pre">de</span> <span class="pre">la</span> <span class="pre">dirección</span> <span class="pre">del</span> <span class="pre">domicilio</span></code> y <code class="docutils literal notranslate"><span class="pre">cat__Estado</span> <span class="pre">actual</span></code> tienen un impacto significativo en clases específicas, indicando posibles diferencias regionales o de estatus jurídico. Estas visualizaciones facilitan la interpretación del modelo y proporcionan insights clave sobre los factores determinantes para cada categoría.</p>
<section id="modelo-de-regresion-logistica-multinomial-generalizado">
<h3>Modelo de regresión logistica multinomial generalizado<a class="headerlink" href="#modelo-de-regresion-logistica-multinomial-generalizado" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC/FLC&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">categorical_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Estado actual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Concepto del Revisor fiscal en su orme&#39;</span><span class="p">,</span>
    <span class="s1">&#39;La compañía está obligada a tener Revisor fiscal?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tipo societario&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Departamento de la dirección del domicilio&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">label_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cantidad de años de la empresa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total de activos (Assets)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total pasivos (Liabilities)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Razón corriente&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación cartera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación proveedores&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nivel de endeudamiento&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Generación Efectivo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Desempleo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Ocupación&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB DEP&#39;</span>
<span class="p">]</span>

<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>

<span class="n">available_years</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">train_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">train_years</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">available_years</span><span class="p">]</span>
<span class="n">test_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">test_years</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">available_years</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Eliminar filas con NaN en las variables seleccionadas</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">model_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">])</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">model_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular la matriz de correlación</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">model_numeric_vars</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

<span class="c1"># Encontrar pares con correlación mayor a 0.8</span>
<span class="n">to_drop_corr</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables a eliminar por alta correlación:&quot;</span><span class="p">,</span> <span class="n">to_drop_corr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables a eliminar por alta correlación: [&#39;Total pasivos (Liabilities)&#39;, &#39;Rotación proveedores&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar las variables altamente correlacionadas</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model_numeric_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_drop_corr</span><span class="p">]</span>
<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>
</pre></div>
</div>
</div>
</div>
<p>El código realiza un preprocesamiento exhaustivo de los datos para garantizar su calidad y adecuación al modelado. Se filtran registros con <code class="docutils literal notranslate"><span class="pre">SD</span></code> (Servicio de Deuda) mayores a 0, se clasifica la variable <code class="docutils literal notranslate"><span class="pre">FDC/FLC</span></code> en rangos categóricos (<code class="docutils literal notranslate"><span class="pre">FDC_FLC_categoria</span></code>), y se transforman variables categóricas a tipo <code class="docutils literal notranslate"><span class="pre">category</span></code> para optimizar memoria y procesamiento. Además, se eliminan observaciones con valores faltantes en las variables seleccionadas y se identifica alta correlación (&gt;0.8) entre variables numéricas, eliminando aquellas redundantes para evitar problemas de multicolinealidad. Este flujo asegura un conjunto de datos limpio, relevante y listo para modelos más robustos y precisos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Actualizar el preprocesador</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">model_numeric_vars</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span> <span class="n">model_categorical_vars</span><span class="p">)</span>
    <span class="p">])</span>


<span class="n">pipeline_logreg</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span>
        <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span>
        <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span>
    <span class="p">))</span>
<span class="p">])</span>

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">time_series_splits</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

    <span class="c1"># Entrenar el modelo</span>
    <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Fecha de Corte&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                ha...unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;,
                 LogisticRegression(class_weight=&#x27;balanced&#x27;, max_iter=1000,
                                    multi_class=&#x27;multinomial&#x27;))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Fecha de Corte&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                ha...unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;,
                 LogisticRegression(class_weight=&#x27;balanced&#x27;, max_iter=1000,
                                    multi_class=&#x27;multinomial&#x27;))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessor: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessor: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                 [&#x27;Cantidad de años de la empresa&#x27;,
                                  &#x27;Fecha de Corte&#x27;, &#x27;Total de activos (Assets)&#x27;,
                                  &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                  &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;,
                                  &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;,
                                  &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;,
                                  &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]),
                                (&#x27;cat&#x27;,
                                 OneHotEncoder(drop=&#x27;first&#x27;,
                                               handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Estado actual&#x27;,
                                  &#x27;Concepto del Revisor fiscal en su orme&#x27;,
                                  &#x27;La compañía está obligada a tener Revisor &#x27;
                                  &#x27;fiscal?&#x27;,
                                  &#x27;Tipo societario&#x27;,
                                  &#x27;Departamento de la dirección del domicilio&#x27;,
                                  &#x27;Clasificación Industrial Internacional &#x27;
                                  &#x27;Uniforme Versión 4 A.C (CIIU)&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Cantidad de años de la empresa&#x27;, &#x27;Fecha de Corte&#x27;, &#x27;Total de activos (Assets)&#x27;, &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;, &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;, &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Estado actual&#x27;, &#x27;Concepto del Revisor fiscal en su orme&#x27;, &#x27;La compañía está obligada a tener Revisor fiscal?&#x27;, &#x27;Tipo societario&#x27;, &#x27;Departamento de la dirección del domicilio&#x27;, &#x27;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(drop=&#x27;first&#x27;, handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LogisticRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(class_weight=&#x27;balanced&#x27;, max_iter=1000,
                   multi_class=&#x27;multinomial&#x27;)</pre></div> </div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred_logreg</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación - Regresión Logística Multinomial:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logreg</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación - Regresión Logística Multinomial:
              precision    recall  f1-score   support

          &lt;0       0.81      0.87      0.84      2466
   [0, 0.67)       0.83      0.58      0.68      2140
[0.67, 0.80)       0.20      0.59      0.30       479
   [0.80, 1)       0.73      0.60      0.66      1326
      [1, ∞)       0.94      0.86      0.90      2981

    accuracy                           0.75      9392
   macro avg       0.70      0.70      0.68      9392
weighted avg       0.81      0.75      0.77      9392
</pre></div>
</div>
</div>
</div>
<p>El código utiliza un pipeline de aprendizaje automático para preprocesar y entrenar un modelo de Regresión Logística Multinomial. El pipeline incluye un transformador de columnas que aplica <strong><code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code></strong> para escalar las variables numéricas y <strong><code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code></strong> para codificar las variables categóricas. La Regresión Logística Multinomial se ajusta utilizando el solver <code class="docutils literal notranslate"><span class="pre">lbfgs</span></code> y una ponderación equilibrada de clases (<code class="docutils literal notranslate"><span class="pre">class_weight='balanced'</span></code>) para manejar desbalances en los datos.</p>
<p>El reporte de clasificación muestra un desempeño general sólido, con una precisión (accuracy) global del 75%. Las clases <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> tienen los mejores resultados (F1-scores de 0.84 y 0.90, respectivamente), mientras que la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> muestra un F1-score bajo (0.30), indicando dificultades para distinguir esta categoría. El promedio ponderado de las métricas refleja un F1-score de 0.77, lo que sugiere un rendimiento equilibrado en general.</p>
<p>El pipeline proporciona un flujo eficiente para procesar datos y entrenar el modelo, asegurando consistencia en el preprocesamiento y optimización del rendimiento. Aunque el modelo clasifica correctamente la mayoría de las observaciones, el bajo desempeño en clases específicas como <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> destaca la necesidad de ajustes adicionales, como mayor recolección de datos para estas clases o ajuste de hiperparámetros.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_df</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Clase Verdadera&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clase Predicha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de Confusión para Regresión Logística Multinomial</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_logreg</span><span class="p">,</span> <span class="s1">&#39;Matriz de Confusión - Regresión Logística Multinomial&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2fafd3608e5ea7a9fa5829c24b525aeec2aa535778c37754afd5389e54062d02.png" src="_images/2fafd3608e5ea7a9fa5829c24b525aeec2aa535778c37754afd5389e54062d02.png" />
</div>
</div>
<p>La matriz de confusión muestra el desempeño del modelo de Regresión Logística Multinomial en el conjunto de prueba, ilustrando la distribución de predicciones correctas e incorrectas para cada clase. Las filas representan las categorías verdaderas, mientras que las columnas muestran las categorías predichas.</p>
<p>El modelo clasifica correctamente un alto número de observaciones en las clases <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> (2139) y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> (2578), como se evidencia por los valores elevados en la diagonal principal. Sin embargo, se observan confusiones significativas en las clases intermedias:</p>
<ul class="simple">
<li><p>La clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> presenta errores frecuentes, siendo mal clasificada como <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67)</span></code> (608) y <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code> (129).</p></li>
<li><p>Para la clase <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code>, las confusiones más comunes ocurren con la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> (447).</p></li>
</ul>
<p>La matriz de confusión indica que el modelo tiene un buen desempeño en las clases extremas (<code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code>), pero enfrenta dificultades para diferenciar las clases intermedias, como <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> y <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Binarizar las etiquetas para ROC</span>
<span class="n">y_test_binarized</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="n">y_test_binarized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Obtener las probabilidades predichas para Regresión Logística Multinomial</span>
<span class="n">y_score_logreg</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">best_logreg</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mejores parámetros de Regresión Logística:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mejores parámetros de Regresión Logística: {&#39;classifier__C&#39;: 100, &#39;classifier__penalty&#39;: &#39;l2&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;classifier__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline_logreg</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 5 candidates, totalling 25 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         StandardScaler(),
                                                                         [&#x27;Cantidad &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;años &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;la &#x27;
                                                                          &#x27;empresa&#x27;,
                                                                          &#x27;Fecha &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;Corte&#x27;,
                                                                          &#x27;Total &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;activos &#x27;
                                                                          &#x27;(Assets)&#x27;,
                                                                          &#x27;Razón &#x27;
                                                                          &#x27;corriente&#x27;,
                                                                          &#x27;Rotación &#x27;
                                                                          &#x27;cartera&#x27;,
                                                                          &#x27;ROA&#x27;,
                                                                          &#x27;ROE&#x27;,
                                                                          &#x27;Nivel &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;endeudamiento&#x27;,
                                                                          &#x27;Generación &#x27;
                                                                          &#x27;Efectivo&#x27;,
                                                                          &#x27;SD&#x27;,
                                                                          &#x27;FDC&#x27;,
                                                                          &#x27;Tasa &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;Desempleo&#x27;,
                                                                          &#x27;Tasa &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;...
                                                                          &#x27;Departamento &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;la &#x27;
                                                                          &#x27;dirección &#x27;
                                                                          &#x27;del &#x27;
                                                                          &#x27;domicilio&#x27;,
                                                                          &#x27;Clasificación &#x27;
                                                                          &#x27;Industrial &#x27;
                                                                          &#x27;Internacional &#x27;
                                                                          &#x27;Uniforme &#x27;
                                                                          &#x27;Versión &#x27;
                                                                          &#x27;4 &#x27;
                                                                          &#x27;A.C &#x27;
                                                                          &#x27;(CIIU)&#x27;])])),
                                       (&#x27;classifier&#x27;,
                                        LogisticRegression(class_weight=&#x27;balanced&#x27;,
                                                           max_iter=1000,
                                                           multi_class=&#x27;multinomial&#x27;))]),
             n_jobs=-1,
             param_grid={&#x27;classifier__C&#x27;: [0.01, 0.1, 1, 10, 100],
                         &#x27;classifier__penalty&#x27;: [&#x27;l2&#x27;]},
             scoring=&#x27;accuracy&#x27;, verbose=2)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;preprocessor&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         StandardScaler(),
                                                                         [&#x27;Cantidad &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;años &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;la &#x27;
                                                                          &#x27;empresa&#x27;,
                                                                          &#x27;Fecha &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;Corte&#x27;,
                                                                          &#x27;Total &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;activos &#x27;
                                                                          &#x27;(Assets)&#x27;,
                                                                          &#x27;Razón &#x27;
                                                                          &#x27;corriente&#x27;,
                                                                          &#x27;Rotación &#x27;
                                                                          &#x27;cartera&#x27;,
                                                                          &#x27;ROA&#x27;,
                                                                          &#x27;ROE&#x27;,
                                                                          &#x27;Nivel &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;endeudamiento&#x27;,
                                                                          &#x27;Generación &#x27;
                                                                          &#x27;Efectivo&#x27;,
                                                                          &#x27;SD&#x27;,
                                                                          &#x27;FDC&#x27;,
                                                                          &#x27;Tasa &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;Desempleo&#x27;,
                                                                          &#x27;Tasa &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;...
                                                                          &#x27;Departamento &#x27;
                                                                          &#x27;de &#x27;
                                                                          &#x27;la &#x27;
                                                                          &#x27;dirección &#x27;
                                                                          &#x27;del &#x27;
                                                                          &#x27;domicilio&#x27;,
                                                                          &#x27;Clasificación &#x27;
                                                                          &#x27;Industrial &#x27;
                                                                          &#x27;Internacional &#x27;
                                                                          &#x27;Uniforme &#x27;
                                                                          &#x27;Versión &#x27;
                                                                          &#x27;4 &#x27;
                                                                          &#x27;A.C &#x27;
                                                                          &#x27;(CIIU)&#x27;])])),
                                       (&#x27;classifier&#x27;,
                                        LogisticRegression(class_weight=&#x27;balanced&#x27;,
                                                           max_iter=1000,
                                                           multi_class=&#x27;multinomial&#x27;))]),
             n_jobs=-1,
             param_grid={&#x27;classifier__C&#x27;: [0.01, 0.1, 1, 10, 100],
                         &#x27;classifier__penalty&#x27;: [&#x27;l2&#x27;]},
             scoring=&#x27;accuracy&#x27;, verbose=2)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">best_estimator_: Pipeline</label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Fecha de Corte&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                ha...n=&#x27;ignore&#x27;),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;,
                 LogisticRegression(C=100, class_weight=&#x27;balanced&#x27;,
                                    max_iter=1000,
                                    multi_class=&#x27;multinomial&#x27;))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessor: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessor: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                 [&#x27;Cantidad de años de la empresa&#x27;,
                                  &#x27;Fecha de Corte&#x27;, &#x27;Total de activos (Assets)&#x27;,
                                  &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                  &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;,
                                  &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;,
                                  &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;,
                                  &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]),
                                (&#x27;cat&#x27;,
                                 OneHotEncoder(drop=&#x27;first&#x27;,
                                               handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Estado actual&#x27;,
                                  &#x27;Concepto del Revisor fiscal en su orme&#x27;,
                                  &#x27;La compañía está obligada a tener Revisor &#x27;
                                  &#x27;fiscal?&#x27;,
                                  &#x27;Tipo societario&#x27;,
                                  &#x27;Departamento de la dirección del domicilio&#x27;,
                                  &#x27;Clasificación Industrial Internacional &#x27;
                                  &#x27;Uniforme Versión 4 A.C (CIIU)&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Cantidad de años de la empresa&#x27;, &#x27;Fecha de Corte&#x27;, &#x27;Total de activos (Assets)&#x27;, &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;, &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;, &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Estado actual&#x27;, &#x27;Concepto del Revisor fiscal en su orme&#x27;, &#x27;La compañía está obligada a tener Revisor fiscal?&#x27;, &#x27;Tipo societario&#x27;, &#x27;Departamento de la dirección del domicilio&#x27;, &#x27;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(drop=&#x27;first&#x27;, handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;LogisticRegression<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(C=100, class_weight=&#x27;balanced&#x27;, max_iter=1000,
                   multi_class=&#x27;multinomial&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<p>El código utiliza <strong>GridSearchCV</strong> para optimizar los hiperparámetros del modelo de Regresión Logística Multinomial dentro de un pipeline, evaluando diferentes valores de la regularización <code class="docutils literal notranslate"><span class="pre">C</span></code> y el tipo de penalización (<code class="docutils literal notranslate"><span class="pre">l2</span></code>). Los mejores hiperparámetros encontrados fueron <code class="docutils literal notranslate"><span class="pre">C=100</span></code> y <code class="docutils literal notranslate"><span class="pre">penalty='l2'</span></code>, lo que sugiere que el modelo alcanza un mejor desempeño con una regularización más suave y penalización de norma <code class="docutils literal notranslate"><span class="pre">l2</span></code>. Este enfoque, que integra el preprocesamiento y el modelo, asegura consistencia y un ajuste óptimo mediante validación cruzada (<code class="docutils literal notranslate"><span class="pre">cv=5</span></code>), mejorando la capacidad del modelo para generalizar en nuevos datos. La búsqueda exhaustiva garantiza un modelo robusto y eficiente adaptado a las características del conjunto de datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rfe</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(</span>
        <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span>
        <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">),</span> <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_rfe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;feature_selection&#39;</span><span class="p">,</span> <span class="n">rfe</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span>
        <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span>
        <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span>
    <span class="p">))</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluar el mejor modelo de Regresión Logística</span>
<span class="n">y_pred_best_logreg</span> <span class="o">=</span> <span class="n">best_logreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación - Mejor Regresión Logística:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_best_logreg</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación - Mejor Regresión Logística:
              precision    recall  f1-score   support

          &lt;0       0.89      0.98      0.93      2466
   [0, 0.67)       0.98      0.74      0.84      2140
[0.67, 0.80)       0.40      0.90      0.55       479
   [0.80, 1)       0.95      0.81      0.88      1326
      [1, ∞)       0.99      0.95      0.97      2981

    accuracy                           0.89      9392
   macro avg       0.84      0.88      0.84      9392
weighted avg       0.93      0.89      0.90      9392
</pre></div>
</div>
</div>
</div>
<p>El mejor modelo de Regresión Logística Multinomial, optimizado con GridSearchCV y selección de características mediante RFE, alcanzó un desempeño destacado con una precisión general del <strong>89%</strong> y un F1-score ponderado de <strong>0.90</strong>, mostrando un balance efectivo entre precisión y recall. Las clases <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code>, <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67)</span></code>, <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code> y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> presentan altos F1-scores (entre 0.84 y 0.97), reflejando un excelente desempeño del modelo en estas categorías. Aunque la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> mejoró su recall (0.90), su precisión baja (0.40) indica que sigue siendo la más desafiante, lo que resalta la necesidad de ajustes adicionales, como balanceo de clases o refinamiento de hiperparámetros.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para plotear Curvas ROC</span>
<span class="k">def</span> <span class="nf">plot_roc</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">fpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">tpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_score</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Clase </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">) - AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>  <span class="c1"># Línea diagonal</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Falsos Positivos (FPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Verdaderos Positivos (TPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Curvas ROC para Regresión Logística Multinomial</span>
<span class="n">plot_roc</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">,</span> <span class="n">y_score_logreg</span><span class="p">,</span> <span class="s1">&#39;Curvas ROC Multiclase - Regresión Logística Multinomial&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f338c44d9dc387d4a82b4559fd5b14abf133fdeb5e59615b1949610794303a7e.png" src="_images/f338c44d9dc387d4a82b4559fd5b14abf133fdeb5e59615b1949610794303a7e.png" />
</div>
</div>
<p>La gráfica de curvas ROC multiclase muestra un desempeño sólido del modelo optimizado de Regresión Logística Multinomial, con áreas bajo la curva (AUC) altas para la mayoría de las clases. Las clases extremas <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> y <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code> tienen los mejores resultados, con AUC de 0.97 y 0.96 respectivamente, lo que refleja una alta capacidad de discriminación. Aunque la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> presenta un AUC menor (0.88), sigue mostrando un desempeño aceptable. Estas curvas confirman que el modelo clasifica de manera efectiva la mayoría de las categorías, siendo particularmente confiable en las clases mayoritarias y extremos, con oportunidades de mejora en la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> para incrementar aún más su precisión global.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_rfe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred_rfe</span> <span class="o">=</span> <span class="n">pipeline_rfe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación - Regresión Logística con RFE:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_rfe</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.

/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning:

&#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación - Regresión Logística con RFE:
              precision    recall  f1-score   support

          &lt;0       0.91      0.84      0.87      2466
   [0, 0.67)       0.72      0.81      0.76      2140
[0.67, 0.80)       0.31      0.51      0.38       479
   [0.80, 1)       0.84      0.72      0.78      1326
      [1, ∞)       0.99      0.92      0.95      2981

    accuracy                           0.82      9392
   macro avg       0.75      0.76      0.75      9392
weighted avg       0.85      0.82      0.83      9392
</pre></div>
</div>
</div>
</div>
<p>El modelo de Regresión Logística optimizado con RFE muestra un desempeño general aceptable, alcanzando una precisión global del <strong>82%</strong> y un F1-score ponderado de <strong>0.83</strong>. Las clases extremas, como <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code>, destacan con altos F1-scores de <strong>0.87</strong> y <strong>0.95</strong>, respectivamente, mientras que las clases intermedias <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67)</span></code> y <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code> presentan un rendimiento moderado con F1-scores de <strong>0.76</strong> y <strong>0.78</strong>. La clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> sigue siendo la más problemática, con un F1-score de <strong>0.38</strong> y una precisión baja de <strong>0.31</strong>, indicando dificultades para distinguir esta categoría.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># a. Regresión Logística Multinomial</span>
<span class="n">logreg</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span>
<span class="n">preprocessor_logreg</span> <span class="o">=</span> <span class="n">pipeline_logreg</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span>
<span class="n">feature_names_logreg</span> <span class="o">=</span> <span class="n">preprocessor_logreg</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

<span class="n">coefficients</span> <span class="o">=</span> <span class="n">logreg</span><span class="o">.</span><span class="n">coef_</span>

<span class="c1"># Crear un DataFrame para los coeficientes</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">feature_names_logreg</span><span class="p">)</span>
<span class="n">coef_df</span><span class="p">[</span><span class="s1">&#39;Clase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logreg</span><span class="o">.</span><span class="n">classes_</span>

<span class="c1"># Reorganizar las columnas</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Clase&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coeficientes del modelo - Regresión Logística Multinomial:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">coef_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coeficientes del modelo - Regresión Logística Multinomial:
       num__Cantidad de años de la empresa  num__Fecha de Corte  \
Clase                                                             
0                                 0.000242            -0.005498   
1                                -0.030214            -0.039216   
2                                 0.046792            -0.011861   
3                                 0.040271             0.023981   
4                                -0.057091             0.032593   

       num__Total de activos (Assets)  num__Razón corriente  \
Clase                                                         
0                            0.353258              0.218359   
1                            0.427160              0.312202   
2                           -0.478168             -0.976538   
3                           -0.562466              0.285277   
4                            0.260216              0.160700   

       num__Rotación cartera  num__ROA  num__ROE  num__Nivel de endeudamiento  \
Clase                                                                           
0                  -0.038705 -0.218569  0.011143                     0.134999   
1                  -0.055320 -0.111725  0.004361                     0.101619   
2                  -0.072235  0.285993 -0.006658                    -0.043290   
3                   0.182764  0.402371  0.005456                    -0.193912   
4                  -0.016503 -0.358070 -0.014302                     0.000584   

       num__Generación Efectivo    num__SD  ...  \
Clase                                       ...   
0                      0.097987  23.580761  ...   
1                      0.062829  22.788268  ...   
2                     -0.053443  -2.986460  ...   
3                     -0.031694 -23.152539  ...   
4                     -0.075680 -20.230031  ...   

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Agricultura, ganadería, caza, silvicultura y pesca.  \
Clase                                                                                                                                  
0                                               0.078719                                                                               
1                                              -0.024908                                                                               
2                                              -0.119621                                                                               
3                                               0.042717                                                                               
4                                               0.023093                                                                               

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Alojamiento y servicios de comida.  \
Clase                                                                                                                 
0                                              -0.041163                                                              
1                                              -0.077226                                                              
2                                              -0.177513                                                              
3                                               0.255345                                                              
4                                               0.040556                                                              

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Comercio al por mayor y al por menor; reparación de vehículos automotores y motocicletas.  \
Clase                                                                                                                                                                        
0                                               0.054657                                                                                                                     
1                                               0.085802                                                                                                                     
2                                              -0.091909                                                                                                                     
3                                               0.045791                                                                                                                     
4                                              -0.094341                                                                                                                     

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Construcción.  \
Clase                                                                                            
0                                               0.088083                                         
1                                              -0.172372                                         
2                                              -0.099944                                         
3                                               0.178001                                         
4                                               0.006232                                         

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Educación.  \
Clase                                                                                         
0                                              -0.065153                                      
1                                              -0.147038                                      
2                                               0.042665                                      
3                                               0.057451                                      
4                                               0.112075                                      

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Explotación de minas y canteras.  \
Clase                                                                                                               
0                                               0.138757                                                            
1                                              -0.221430                                                            
2                                              -0.279974                                                            
3                                               0.175971                                                            
4                                               0.186676                                                            

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Industrias manufactureras.  \
Clase                                                                                                         
0                                               0.070990                                                      
1                                               0.034991                                                      
2                                              -0.144359                                                      
3                                               0.071118                                                      
4                                              -0.032740                                                      

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Información y comunicaciones.  \
Clase                                                                                                            
0                                              -0.035663                                                         
1                                              -0.272848                                                         
2                                              -0.050151                                                         
3                                               0.125324                                                         
4                                               0.233338                                                         

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Suministro de electricidad, gas, vapor y aire acondicionado.  \
Clase                                                                                                                                           
0                                               0.080153                                                                                        
1                                              -0.336811                                                                                        
2                                              -0.314702                                                                                        
3                                               0.315379                                                                                        
4                                               0.255981                                                                                        

       cat__Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)_Transporte y almacenamiento.  
Clase                                                                                                          
0                                               0.095131                                                       
1                                              -0.139928                                                       
2                                              -0.134141                                                       
3                                               0.105018                                                       
4                                               0.073920                                                       

[5 rows x 69 columns]
</pre></div>
</div>
</div>
</div>
<p>Los coeficientes del modelo de Regresión Logística Multinomial permite identificar la influencia de cada variable en las probabilidades de clasificación para cada clase. Utilizando el pipeline, se extrajeron los coeficientes asociados a las características preprocesadas, organizándolos en un DataFrame estructurado por clase. Este enfoque facilita la interpretación del impacto individual de cada variable sobre las decisiones del modelo, proporcionando insights clave sobre qué factores son más relevantes para determinar la pertenencia a una clase específica.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizar los coeficientes más importantes por clase</span>
<span class="k">for</span> <span class="n">clase</span> <span class="ow">in</span> <span class="n">logreg</span><span class="o">.</span><span class="n">classes_</span><span class="p">:</span>
    <span class="n">coef_clase</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clase</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">coef_clase</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Variables más importantes para la Clase </span><span class="si">{</span><span class="n">clase</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">clase</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Coeficiente Absoluto&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/083a419451410046991077a5be8a9b70db659ef71e99b6ee03a1814304273754.png" src="_images/083a419451410046991077a5be8a9b70db659ef71e99b6ee03a1814304273754.png" />
<img alt="_images/366be7e243d7f864e07435921291871c3c34b52922a7d00d62bf2db27bd02ef4.png" src="_images/366be7e243d7f864e07435921291871c3c34b52922a7d00d62bf2db27bd02ef4.png" />
<img alt="_images/d0a83e73b95fbcf3289d7bc112c8ccf8bf031c79e295bcee7b1a5e5c54a3d8d7.png" src="_images/d0a83e73b95fbcf3289d7bc112c8ccf8bf031c79e295bcee7b1a5e5c54a3d8d7.png" />
<img alt="_images/92439437c9b9465f7780d9498f1e75fef2228d4339e3d3b8ce77d28957178d83.png" src="_images/92439437c9b9465f7780d9498f1e75fef2228d4339e3d3b8ce77d28957178d83.png" />
<img alt="_images/e69e7642f14aec9b5b04eb02b5faf09932ecd23a1ebe3cd996af1eedb120b238.png" src="_images/e69e7642f14aec9b5b04eb02b5faf09932ecd23a1ebe3cd996af1eedb120b238.png" />
</div>
</div>
<p>El análisis de los coeficientes del modelo de regresión logística multinomial permitió identificar las variables más relevantes para cada una de las clases en el modelo, reflejando la influencia de las características tanto numéricas como categóricas. Las gráficas generadas para cada clase mostraron que variables como el servicio de deuda (SD) y el flujo de caja disponible (FDC) destacan consistentemente en todas las clases por su alta contribución predictiva, indicando su importancia en la clasificación de las categorías. Adicionalmente, variables categóricas como el tipo societario y la ubicación geográfica de la empresa también aportaron valor significativo en ciertas clases, reflejando una interacción entre factores financieros y estructurales en el desempeño de las empresas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_logreg</span><span class="p">,</span> <span class="s1">&#39;modelo_logreg.joblib&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;modelo_logreg.joblib&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="random-forest">
<h3>Random Forest<a class="headerlink" href="#random-forest" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filtrar datos si es necesario (ejemplo: eliminar filas con &#39;SD&#39; &lt;= 0)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Convertir &#39;Fecha de Corte&#39; a entero si no lo es</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Crear la variable objetivo &#39;FDC_FLC_categoria&#39;</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC/FLC&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Convertir variables categóricas a tipo &#39;category&#39;</span>
<span class="n">categorical_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Estado actual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Concepto del Revisor fiscal en su orme&#39;</span><span class="p">,</span>
    <span class="s1">&#39;La compañía está obligada a tener Revisor fiscal?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tipo societario&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Departamento de la dirección del domicilio&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="c1"># Codificar la variable objetivo</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

<span class="c1"># 2. Definir las Etiquetas y Crear `label_mapping`</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">label_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)}</span>

<span class="c1"># Verificar el mapeo</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label Mapping:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 3. Definir las Variables del Modelo</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cantidad de años de la empresa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total de activos (Assets)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total pasivos (Liabilities)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Razón corriente&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación cartera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación proveedores&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nivel de endeudamiento&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Generación Efectivo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Desempleo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Ocupación&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB DEP&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label Mapping:
0: &lt;0
1: [0, 0.67)
2: [0.67, 0.80)
3: [0.80, 1)
4: [1, ∞)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_categorical_vars</span> <span class="o">=</span> <span class="n">categorical_vars</span> 

<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>

<span class="n">available_years</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="n">model_numeric_vars</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">model_categorical_vars</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">model_numeric_vars</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">model_categorical_vars</span><span class="p">)</span>
    <span class="p">])</span>


<span class="c1"># Define the pipeline</span>
<span class="n">pipeline_rf</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">))</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">time_series_splits</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

    <span class="c1"># Entrenar el modelo</span>
    <span class="n">pipeline_rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Predecir</span>
    <span class="n">y_pred_rf</span> <span class="o">=</span> <span class="n">pipeline_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación - Random Forest:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_rf</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación - Random Forest:
              precision    recall  f1-score   support

          &lt;0       0.94      0.80      0.86      2466
   [0, 0.67)       0.78      1.00      0.88      2140
[0.67, 0.80)       0.61      0.02      0.04       479
   [0.80, 1)       0.93      0.85      0.88      1326
      [1, ∞)       0.85      0.96      0.90      2981

    accuracy                           0.86      9392
   macro avg       0.82      0.72      0.71      9392
weighted avg       0.86      0.86      0.84      9392
</pre></div>
</div>
</div>
</div>
<p>El modelo Random Forest fue evaluado utilizando una estructura temporal de entrenamiento y prueba, obteniendo un reporte de clasificación que muestra un desempeño robusto en varias clases. La precisión más alta se observa en las clases “&lt;0” y “[1, ∞)” con valores de 0.94 y 0.85 respectivamente, destacando su capacidad para clasificar correctamente estos casos. Sin embargo, para la clase “[0.67, 0.80)”, el modelo presenta desafíos con un F1-score de solo 0.04, indicando dificultades para manejar esta categoría específica. Con una exactitud general de 0.86 y una media ponderada en las métricas de precisión, recall y F1-score superior a 0.84, el modelo muestra un rendimiento aceptable, aunque podría beneficiarse de ajustes adicionales para mejorar en clases minoritarias.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline_rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;))]),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Fecha de Corte&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Total pasivos &#x27;
                                                   &#x27;(Liabilities)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;,
                                                   &#x27;Rotación proveedores&#x27;,
                                                   &#x27;ROA&#x27;, &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;S...
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;,
                 RandomForestClassifier(class_weight=&#x27;balanced&#x27;, n_jobs=-1,
                                        random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-30" type="checkbox" ><label for="sk-estimator-id-30" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;))]),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Fecha de Corte&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Total pasivos &#x27;
                                                   &#x27;(Liabilities)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;,
                                                   &#x27;Rotación proveedores&#x27;,
                                                   &#x27;ROA&#x27;, &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;S...
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;,
                 RandomForestClassifier(class_weight=&#x27;balanced&#x27;, n_jobs=-1,
                                        random_state=42))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-31" type="checkbox" ><label for="sk-estimator-id-31" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessor: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessor: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;))]),
                                 [&#x27;Cantidad de años de la empresa&#x27;,
                                  &#x27;Fecha de Corte&#x27;, &#x27;Total de activos (Assets)&#x27;,
                                  &#x27;Total pasivos (Liabilities)&#x27;,
                                  &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;,
                                  &#x27;Rotación proveedores&#x27;, &#x27;ROA&#x27;, &#x27;ROE&#x27;,
                                  &#x27;Nivel de endeudamiento&#x27;,
                                  &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;,
                                  &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Oc...
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                 [&#x27;Estado actual&#x27;,
                                  &#x27;Concepto del Revisor fiscal en su orme&#x27;,
                                  &#x27;La compañía está obligada a tener Revisor &#x27;
                                  &#x27;fiscal?&#x27;,
                                  &#x27;Tipo societario&#x27;,
                                  &#x27;Departamento de la dirección del domicilio&#x27;,
                                  &#x27;Clasificación Industrial Internacional &#x27;
                                  &#x27;Uniforme Versión 4 A.C (CIIU)&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-32" type="checkbox" ><label for="sk-estimator-id-32" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Cantidad de años de la empresa&#x27;, &#x27;Fecha de Corte&#x27;, &#x27;Total de activos (Assets)&#x27;, &#x27;Total pasivos (Liabilities)&#x27;, &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;Rotación proveedores&#x27;, &#x27;ROA&#x27;, &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;, &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-33" type="checkbox" ><label for="sk-estimator-id-33" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-34" type="checkbox" ><label for="sk-estimator-id-34" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Estado actual&#x27;, &#x27;Concepto del Revisor fiscal en su orme&#x27;, &#x27;La compañía está obligada a tener Revisor fiscal?&#x27;, &#x27;Tipo societario&#x27;, &#x27;Departamento de la dirección del domicilio&#x27;, &#x27;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-35" type="checkbox" ><label for="sk-estimator-id-35" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-36" type="checkbox" ><label for="sk-estimator-id-36" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-37" type="checkbox" ><label for="sk-estimator-id-37" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(class_weight=&#x27;balanced&#x27;, n_jobs=-1, random_state=42)</pre></div> </div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de Confusión para Random Forest</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_rf</span><span class="p">,</span> <span class="s1">&#39;Matriz de Confusión - Random Forest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f72c59a041a24a061f124d231bedefa6ecc66ae3f3e3be9e070766ba9512036e.png" src="_images/f72c59a041a24a061f124d231bedefa6ecc66ae3f3e3be9e070766ba9512036e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y_score_rf</span> <span class="o">=</span> <span class="n">pipeline_rf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">plot_roc</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">,</span> <span class="n">y_score_rf</span><span class="p">,</span> <span class="s1">&#39;Curvas ROC Multiclase - Random Forest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3862ee1a6b260c01d7e10cbea46dfbe102b625e11cebe40c5f942b79100cd0cb.png" src="_images/3862ee1a6b260c01d7e10cbea46dfbe102b625e11cebe40c5f942b79100cd0cb.png" />
</div>
</div>
<p>El modelo de Random Forest mostró un desempeño notable en la clasificación multiclase, logrando un accuracy global del 86% y valores de AUC superiores a 0.94 para todas las clases. Aunque presentó alta precisión en clases predominantes como <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> y <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code>, su capacidad para identificar correctamente la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> fue limitada debido al bajo recall (2%) en esta categoría. Además, la matriz de confusión reveló un desafío en la correcta clasificación de muestras minoritarias, indicando que estas fueron confundidas principalmente con clases adyacentes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">importances_by_year</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="n">data_year</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
    <span class="n">X_year</span> <span class="o">=</span> <span class="n">data_year</span><span class="p">[</span><span class="n">model_vars</span><span class="p">]</span>
    <span class="n">y_year</span> <span class="o">=</span> <span class="n">data_year</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">X_year</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Año </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> omitido por tener pocas muestras.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="n">X_year</span> <span class="o">=</span> <span class="n">X_year</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">y_year</span> <span class="o">=</span> <span class="n">y_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X_year</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># Entrenar el modelo</span>
    <span class="n">rf_year</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
            <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
            <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span>
        <span class="p">))</span>
    <span class="p">])</span>
    <span class="n">rf_year</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_year</span><span class="p">,</span> <span class="n">y_year</span><span class="p">)</span>

    <span class="c1"># Obtener importancias</span>
    <span class="n">importances_year</span> <span class="o">=</span> <span class="n">rf_year</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feature_importances_</span>
    <span class="n">feature_names_year</span> <span class="o">=</span> <span class="n">rf_year</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

    <span class="c1"># Guardar las importancias</span>
    <span class="n">importances_by_year</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">importances_year</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names_year</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modelo entrenado para el año </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2017.
Modelo entrenado para el año 2018.
Modelo entrenado para el año 2019.
Modelo entrenado para el año 2020.
Modelo entrenado para el año 2021.
Modelo entrenado para el año 2022.
Modelo entrenado para el año 2023.
</pre></div>
</div>
</div>
</div>
<p>Se entrenó un modelo Random Forest para cada año disponible en los datos, después de filtrar por años con suficientes muestras (más de 50). Los pasos incluyen la preparación de datos para cada año, manejo de valores nulos y uso de una pipeline para preprocesamiento y entrenamiento del modelo. Las importancias de las características se calculan y guardan para cada año, utilizando los nombres de las variables procesadas por la pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear un DataFrame de importancias por año</span>
<span class="n">importances_df_year</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">importances_by_year</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># Seleccionar las variables más importantes en promedio</span>
<span class="n">mean_importances</span> <span class="o">=</span> <span class="n">importances_df_year</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">top_features_time</span> <span class="o">=</span> <span class="n">mean_importances</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">importances</span> <span class="o">=</span> <span class="n">pipeline_rf</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">pipeline_rf</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

<span class="n">importances_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">feature_names</span><span class="p">,</span>
    <span class="s1">&#39;Importancia&#39;</span><span class="p">:</span> <span class="n">importances</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Importancia&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Importancia&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">importances_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 15 Importancias de Variables - Random Forest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Importancia&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aeb188b6caae0ccbac8a58ecef8138d272b9f30f5972d4af5f40dedb00d56901.png" src="_images/aeb188b6caae0ccbac8a58ecef8138d272b9f30f5972d4af5f40dedb00d56901.png" />
</div>
</div>
<p>La gráfica ilustra cómo las cinco variables más importantes en el modelo Random Forest han contribuido a las predicciones a lo largo de los años. Se observa que <code class="docutils literal notranslate"><span class="pre">num_FDC</span></code> y <code class="docutils literal notranslate"><span class="pre">num_SD</span></code> mantienen una importancia constante y destacada, lo que sugiere su papel crucial en el análisis durante todo el período evaluado. Otras variables, como <code class="docutils literal notranslate"><span class="pre">num_Generación</span> <span class="pre">Efectivo</span></code> y <code class="docutils literal notranslate"><span class="pre">num_ROA</span></code>, muestran menor impacto, pero permanecen relevantes en las predicciones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotear la importancia a lo largo del tiempo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_features_time</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">importances_df_year</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">importances_df_year</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Año&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Importancia&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Importancia de las Variables a lo Largo del Tiempo - Random Forest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c5b4e314d5642732f4afa221f96b5396d97d0254d343d38907233a08c3e105c7.png" src="_images/c5b4e314d5642732f4afa221f96b5396d97d0254d343d38907233a08c3e105c7.png" />
</div>
</div>
<p>La gráfica compara la importancia promedio de las variables clave (<code class="docutils literal notranslate"><span class="pre">num_FDC</span></code>, <code class="docutils literal notranslate"><span class="pre">num_SD</span></code>, <code class="docutils literal notranslate"><span class="pre">num_Generación</span> <span class="pre">Efectivo</span></code>, <code class="docutils literal notranslate"><span class="pre">num_ROA</span></code>, <code class="docutils literal notranslate"><span class="pre">num_Total</span> <span class="pre">de</span> <span class="pre">activos</span> <span class="pre">(Assets)</span></code>) en el modelo Random Forest a lo largo del tiempo, desde 2017 hasta 2023. Destaca que <code class="docutils literal notranslate"><span class="pre">num_FDC</span></code> lidera consistentemente como la variable más significativa, seguida por <code class="docutils literal notranslate"><span class="pre">num_SD</span></code>, que también muestra una tendencia estable, aunque ligeramente creciente hacia 2023. Las otras variables mantienen un impacto menor pero constante en la predicción.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Guardar el modelo de Random Forest</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_rf</span><span class="p">,</span> <span class="s1">&#39;modelo_rf.joblib&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modelos guardados exitosamente en archivos Joblib.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelos guardados exitosamente en archivos Joblib.
</pre></div>
</div>
</div>
</div>
</section>
<section id="xgbooost">
<h3>XGBOOOST<a class="headerlink" href="#xgbooost" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

<span class="c1"># Filtrar datos si es necesario (ejemplo: eliminar filas con &#39;SD&#39; &lt;= 0)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SD&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Convertir &#39;Fecha de Corte&#39; a entero si no lo es</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Crear la variable objetivo &#39;FDC_FLC_categoria&#39;</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC/FLC&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convertir variables categóricas a tipo &#39;category&#39;</span>
<span class="n">categorical_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Estado actual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Concepto del Revisor fiscal en su orme&#39;</span><span class="p">,</span>
    <span class="s1">&#39;La compañía está obligada a tener Revisor fiscal?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tipo societario&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Departamento de la dirección del domicilio&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="c1"># Codificar la variable objetivo</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

<span class="c1"># Definir las Etiquetas y Crear `label_mapping`</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">label_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)}</span>

<span class="c1"># Verificar el mapeo</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label Mapping:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Definir las Variables del Modelo</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cantidad de años de la empresa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total de activos (Assets)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total pasivos (Liabilities)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Razón corriente&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación cartera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación proveedores&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nivel de endeudamiento&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Generación Efectivo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Desempleo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Ocupación&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB DEP&#39;</span>
<span class="p">]</span>

<span class="n">model_categorical_vars</span> <span class="o">=</span> <span class="n">categorical_vars</span>  <span class="c1"># Ya definidas y convertidas a &#39;category&#39;</span>

<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label Mapping:
0: &lt;0
1: [0, 0.67)
2: [0.67, 0.80)
3: [0.80, 1)
4: [1, ∞)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Limpiar los Datos (Eliminar filas con NaN)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">model_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">])</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">model_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reducir la Multicolinealidad</span>
<span class="c1"># Calcular la matriz de correlación</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">model_numeric_vars</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="c1"># Seleccionar la parte superior de la matriz de correlación</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

<span class="c1"># Encontrar pares con correlación mayor a 0.8</span>
<span class="n">to_drop_corr</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables a eliminar por alta correlación:&quot;</span><span class="p">,</span> <span class="n">to_drop_corr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables a eliminar por alta correlación: [&#39;Total pasivos (Liabilities)&#39;, &#39;Rotación proveedores&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar variables altamente correlacionadas</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model_numeric_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_drop_corr</span><span class="p">]</span>
<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir el Preprocesador</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">model_numeric_vars</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span> <span class="n">model_categorical_vars</span><span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir el Pipeline para XGBoost</span>
<span class="n">pipeline_xgb</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span>
        <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;multi:softprob&#39;</span><span class="p">,</span>
        <span class="n">num_class</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Ajusta según el número de clases</span>
        <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span>
        <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">))</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Entrenar el Modelo XGBoost</span>
<span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">time_series_splits</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

    <span class="c1"># Entrenar el modelo</span>
    <span class="n">pipeline_xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:27:27] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-6 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-6 {
  color: var(--sklearn-color-text);
}

#sk-container-id-6 pre {
  padding: 0;
}

#sk-container-id-6 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-6 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-6 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-6 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-6 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-6 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-6 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-6 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-6 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-6 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-6 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-6 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-6 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-6 div.sk-label label.sk-toggleable__label,
#sk-container-id-6 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-6 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-6 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-6 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-6 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-6 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-6 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-6 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-6 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-6 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                handle_unknown=&#x27;i...
                               feature_types=None, gamma=None, grow_policy=None,
                               importance_type=None,
                               interaction_constraints=None, learning_rate=None,
                               max_bin=None, max_cat_threshold=None,
                               max_cat_to_onehot=None, max_delta_step=None,
                               max_depth=None, max_leaves=None,
                               min_child_weight=None, missing=nan,
                               monotone_constraints=None, multi_strategy=None,
                               n_estimators=None, n_jobs=-1, num_class=5,
                               num_parallel_tree=None, ...))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-38" type="checkbox" ><label for="sk-estimator-id-38" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                handle_unknown=&#x27;i...
                               feature_types=None, gamma=None, grow_policy=None,
                               importance_type=None,
                               interaction_constraints=None, learning_rate=None,
                               max_bin=None, max_cat_threshold=None,
                               max_cat_to_onehot=None, max_delta_step=None,
                               max_depth=None, max_leaves=None,
                               min_child_weight=None, missing=nan,
                               monotone_constraints=None, multi_strategy=None,
                               n_estimators=None, n_jobs=-1, num_class=5,
                               num_parallel_tree=None, ...))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-39" type="checkbox" ><label for="sk-estimator-id-39" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessor: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessor: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                 [&#x27;Cantidad de años de la empresa&#x27;,
                                  &#x27;Total de activos (Assets)&#x27;,
                                  &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                  &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;,
                                  &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;,
                                  &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;,
                                  &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]),
                                (&#x27;cat&#x27;,
                                 OneHotEncoder(drop=&#x27;first&#x27;,
                                               handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Estado actual&#x27;,
                                  &#x27;Concepto del Revisor fiscal en su orme&#x27;,
                                  &#x27;La compañía está obligada a tener Revisor &#x27;
                                  &#x27;fiscal?&#x27;,
                                  &#x27;Tipo societario&#x27;,
                                  &#x27;Departamento de la dirección del domicilio&#x27;,
                                  &#x27;Clasificación Industrial Internacional &#x27;
                                  &#x27;Uniforme Versión 4 A.C (CIIU)&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-40" type="checkbox" ><label for="sk-estimator-id-40" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Cantidad de años de la empresa&#x27;, &#x27;Total de activos (Assets)&#x27;, &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;, &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;, &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-41" type="checkbox" ><label for="sk-estimator-id-41" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-42" type="checkbox" ><label for="sk-estimator-id-42" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Estado actual&#x27;, &#x27;Concepto del Revisor fiscal en su orme&#x27;, &#x27;La compañía está obligada a tener Revisor fiscal?&#x27;, &#x27;Tipo societario&#x27;, &#x27;Departamento de la dirección del domicilio&#x27;, &#x27;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-43" type="checkbox" ><label for="sk-estimator-id-43" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(drop=&#x27;first&#x27;, handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-44" type="checkbox" ><label for="sk-estimator-id-44" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">XGBClassifier</label><div class="sk-toggleable__content fitted"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=None, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=&#x27;mlogloss&#x27;,
              feature_types=None, gamma=None, grow_policy=None,
              importance_type=None, interaction_constraints=None,
              learning_rate=None, max_bin=None, max_cat_threshold=None,
              max_cat_to_onehot=None, max_delta_step=None, max_depth=None,
              max_leaves=None, min_child_weight=None, missing=nan,
              monotone_constraints=None, multi_strategy=None, n_estimators=None,
              n_jobs=-1, num_class=5, num_parallel_tree=None, ...)</pre></div> </div></div></div></div></div></div></div></div>
</div>
<p>La estructura del pipeline para el modelo XGBoost consiste en dos componentes principales: un preprocesador de datos y el clasificador <code class="docutils literal notranslate"><span class="pre">XGBClassifier</span></code>. El preprocesador aplica transformaciones específicas a las variables numéricas, como escalado estándar con <code class="docutils literal notranslate"><span class="pre">StandardScaler</span></code>, y a las categóricas, utilizando <code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code> para codificación. El clasificador XGBoost se configura para manejar problemas multiclase mediante la función objetivo <code class="docutils literal notranslate"><span class="pre">multi:softprob</span></code>, evaluando el error logarítmico (<code class="docutils literal notranslate"><span class="pre">mlogloss</span></code>). Este pipeline permite un procesamiento eficiente y entrenamiento del modelo en tareas de clasificación multiclase.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluar el Modelo XGBoost</span>
<span class="n">y_pred_xgb</span> <span class="o">=</span> <span class="n">pipeline_xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación - XGBoost:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_xgb</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación - XGBoost:
              precision    recall  f1-score   support

          &lt;0       0.98      0.98      0.98      2466
   [0, 0.67)       0.99      0.99      0.99      2140
[0.67, 0.80)       0.92      0.90      0.91       479
   [0.80, 1)       0.98      0.98      0.98      1326
      [1, ∞)       0.98      0.98      0.98      2981

    accuracy                           0.98      9392
   macro avg       0.97      0.97      0.97      9392
weighted avg       0.98      0.98      0.98      9392
</pre></div>
</div>
</div>
</div>
<p>El modelo XGBoost mostró un desempeño sobresaliente en el conjunto de prueba, con una precisión y un recall muy altos para todas las clases. La exactitud global (accuracy) alcanzó un 98%, indicando que el modelo predijo correctamente la mayoría de las observaciones. Las métricas promedio ponderado (weighted avg) y macro promedio (macro avg) también son consistentes, con valores de f1-score, precisión y recall superiores al 97%, lo que refleja un equilibrio en el rendimiento del modelo incluso para clases con menos datos, como <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizar la Matriz de Confusión</span>
<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_df</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Clase Verdadera&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clase Predicha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matriz de Confusión para XGBoost</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_xgb</span><span class="p">,</span> <span class="s1">&#39;Matriz de Confusión - XGBoost&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/932196e28d1186c56bb2b5459041420d7d9b5f0e77d9edd052c4989b3020d2cf.png" src="_images/932196e28d1186c56bb2b5459041420d7d9b5f0e77d9edd052c4989b3020d2cf.png" />
</div>
</div>
<p>La matriz de confusión del modelo XGBoost demuestra un desempeño sólido en la clasificación multiclase, con una gran mayoría de predicciones correctas en las clases principales. Las clases <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code>, <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67)</span></code>, <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1)</span></code>, y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞)</span></code> tienen una alta cantidad de predicciones verdaderas positivas, mientras que la clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80)</span></code> presenta más errores en comparación con las demás, aunque sigue siendo aceptable considerando su menor frecuencia en el conjunto de datos. En general, la matriz refleja un balance positivo, lo que confirma el alto rendimiento reportado en las métricas de clasificación.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curvas ROC Multiclase</span>
<span class="c1"># Binarizar las etiquetas para ROC</span>
<span class="n">y_test_binarized</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="n">y_test_binarized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Obtener las probabilidades predichas para XGBoost</span>
<span class="n">y_score_xgb</span> <span class="o">=</span> <span class="n">pipeline_xgb</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para plotear Curvas ROC</span>
<span class="k">def</span> <span class="nf">plot_roc</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">fpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">tpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_score</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Clase </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">) - AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>  <span class="c1"># Línea diagonal</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Falsos Positivos (FPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Verdaderos Positivos (TPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curvas ROC para XGBoost</span>
<span class="n">plot_roc</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">,</span> <span class="n">y_score_xgb</span><span class="p">,</span> <span class="s1">&#39;Curvas ROC Multiclase - XGBoost&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/51297ec653e70dadf0f8fbef028d743da19791ee36de069a654e0264ab521885.png" src="_images/51297ec653e70dadf0f8fbef028d743da19791ee36de069a654e0264ab521885.png" />
</div>
</div>
<p>Las curvas ROC para el modelo XGBoost muestran un desempeño casi perfecto en todas las clases, con valores de AUC (Área Bajo la Curva) de 1.00 para todas las categorías. Esto indica una capacidad excepcional del modelo para distinguir correctamente entre las diferentes clases, tanto en términos de verdaderos positivos como de falsos positivos. La consistencia en el rendimiento para todas las clases refuerza la robustez del modelo y su adaptabilidad a diferentes patrones en los datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importancia de las Variables en XGBoost</span>
<span class="c1"># Obtener las importancias de las variables</span>
<span class="n">xgb_model</span> <span class="o">=</span> <span class="n">pipeline_xgb</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span>
<span class="n">preprocessor_xgb</span> <span class="o">=</span> <span class="n">pipeline_xgb</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span>
<span class="n">feature_names_xgb</span> <span class="o">=</span> <span class="n">preprocessor_xgb</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
<span class="n">importances_xgb</span> <span class="o">=</span> <span class="n">xgb_model</span><span class="o">.</span><span class="n">feature_importances_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear un DataFrame</span>
<span class="n">importances_df_xgb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;Variable&#39;</span><span class="p">:</span> <span class="n">feature_names_xgb</span><span class="p">,</span>
    <span class="s1">&#39;Importancia&#39;</span><span class="p">:</span> <span class="n">importances_xgb</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Importancia&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Importancias de las variables - XGBoost:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">importances_df_xgb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Importancias de las variables - XGBoost:
                                             Variable  Importancia
9                                            num__FDC     0.464286
8                                             num__SD     0.222003
26         cat__Tipo societario_03. SOCIEDAD LIMITADA     0.012360
36  cat__Departamento de la dirección del domicili...     0.011614
58  cat__Clasificación Industrial Internacional Un...     0.011249
..                                                ...          ...
21  cat__Concepto del Revisor fiscal en su orme_04...     0.000000
49  cat__Departamento de la dirección del domicili...     0.000000
47  cat__Departamento de la dirección del domicili...     0.000000
52  cat__Departamento de la dirección del domicili...     0.000000
66  cat__Clasificación Industrial Internacional Un...     0.000000

[68 rows x 2 columns]
</pre></div>
</div>
</div>
</div>
<p>El análisis de las importancias de las variables del modelo XGBoost indica que las características más relevantes para la clasificación son las variables numéricas <strong>FDC</strong> y <strong>SD</strong>, que tienen pesos significativamente más altos en comparación con el resto de las variables. Esto sugiere que estas dos variables tienen una influencia predominante en las predicciones del modelo. Las variables categóricas como el tipo societario y el departamento de la dirección del domicilio tienen importancias menores pero aún contribuyen de manera incremental.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Importancia&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">importances_df_xgb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 15 Importancias de Variables - XGBoost&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Importancia&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/160912f7b6e46ba289b30cc612bd2027e3bd4cc69e601a5784a11c2897a7d1d3.png" src="_images/160912f7b6e46ba289b30cc612bd2027e3bd4cc69e601a5784a11c2897a7d1d3.png" />
</div>
</div>
<p>Las 15 principales variables más importantes según el modelo XGBoost destaca a <strong>FDC</strong> y <strong>SD</strong> como las características más relevantes para la clasificación, con importancias significativamente mayores en comparación con otras variables. Además, se observan contribuciones menores de variables categóricas como el tipo societario, la clasificación industrial y el departamento de domicilio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizar Importancia de las Variables por Año</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">importances_by_year</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="n">data_year</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
    <span class="n">X_year</span> <span class="o">=</span> <span class="n">data_year</span><span class="p">[</span><span class="n">model_vars</span><span class="p">]</span>
    <span class="n">y_year</span> <span class="o">=</span> <span class="n">data_year</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">X_year</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Año </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> omitido por tener pocas muestras.&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="n">X_year</span> <span class="o">=</span> <span class="n">X_year</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">y_year</span> <span class="o">=</span> <span class="n">y_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X_year</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="c1"># Entrenar el modelo XGBoost para el año</span>
    <span class="n">pipeline_xgb_year</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span>
            <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;multi:softprob&#39;</span><span class="p">,</span>
            <span class="n">num_class</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">,</span>
            <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
        <span class="p">))</span>
    <span class="p">])</span>
    <span class="n">pipeline_xgb_year</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_year</span><span class="p">,</span> <span class="n">y_year</span><span class="p">)</span>

    <span class="c1"># Obtener importancias</span>
    <span class="n">importances_year</span> <span class="o">=</span> <span class="n">pipeline_xgb_year</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feature_importances_</span>
    <span class="n">feature_names_year</span> <span class="o">=</span> <span class="n">pipeline_xgb_year</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>

    <span class="c1"># Guardar las importancias</span>
    <span class="n">importances_by_year</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">importances_year</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">feature_names_year</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modelo entrenado para el año </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:29:23] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2017.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:29:31] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2018.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:29:35] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2019.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:29:43] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2020.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:29:49] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2021.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:29:50] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2022.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/xgboost/core.py:158: UserWarning:

[14:29:59] WARNING: /workspace/src/learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2023.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear un DataFrame de importancias por año</span>
<span class="n">importances_df_year</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">importances_by_year</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seleccionar las variables más importantes en promedio</span>
<span class="n">mean_importances</span> <span class="o">=</span> <span class="n">importances_df_year</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">top_features_time</span> <span class="o">=</span> <span class="n">mean_importances</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>  <span class="c1"># Top 5 variables</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotear la importancia a lo largo del tiempo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">top_features_time</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">importances_df_year</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">importances_df_year</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Año&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Importancia&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Importancia de las Variables a lo Largo del Tiempo - XGBoost&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/71834e198172530d5ec2ddc590fbf4bec561fb5b4efd8c996849197ac066eae7.png" src="_images/71834e198172530d5ec2ddc590fbf4bec561fb5b4efd8c996849197ac066eae7.png" />
</div>
</div>
<p>El gráfico refleja la evolución temporal de la importancia de variables en un modelo XGBoost, destacando que las variables numéricas (<code class="docutils literal notranslate"><span class="pre">num_FDC</span></code> y <code class="docutils literal notranslate"><span class="pre">num_SD</span></code>) son consistentemente las más relevantes, con <code class="docutils literal notranslate"><span class="pre">num_SD</span></code> mostrando una tendencia creciente en su influencia. Por otro lado, las variables categóricas tienen menor impacto global pero presentan fluctuaciones que podrían indicar cambios en los patrones de los datos a lo largo del tiempo. Este análisis sugiere que las variables numéricas deben ser priorizadas en el modelo, mientras que las categóricas pueden aportar valor contextual en ciertos períodos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Guardar el Modelo en Archivo Pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;modelo_xgb.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_xgb</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Guardar el Modelo en Archivo Joblib (Opcional pero Recomendado)</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_xgb</span><span class="p">,</span> <span class="s1">&#39;modelo_xgb.joblib&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modelo XGBoost guardado exitosamente en archivos Pickle y Joblib.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo XGBoost guardado exitosamente en archivos Pickle y Joblib.
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-svm">
<h3>Modelo SVM<a class="headerlink" href="#modelo-svm" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir las Variables del Modelo</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cantidad de años de la empresa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total de activos (Assets)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total pasivos (Liabilities)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Razón corriente&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación cartera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación proveedores&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nivel de endeudamiento&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Generación Efectivo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Desempleo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Ocupación&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB DEP&#39;</span>
<span class="p">]</span>

<span class="n">model_categorical_vars</span> <span class="o">=</span> <span class="n">categorical_vars</span>  <span class="c1"># Ya definidas y convertidas a &#39;category&#39;</span>

<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reducir la Multicolinealidad</span>
<span class="c1"># Calcular la matriz de correlación</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">model_numeric_vars</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="c1"># Seleccionar la parte superior de la matriz de correlación</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

<span class="c1"># Encontrar pares con correlación mayor a 0.8</span>
<span class="n">to_drop_corr</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables a eliminar por alta correlación:&quot;</span><span class="p">,</span> <span class="n">to_drop_corr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables a eliminar por alta correlación: [&#39;Total pasivos (Liabilities)&#39;, &#39;Rotación proveedores&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminar variables altamente correlacionadas</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model_numeric_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_drop_corr</span><span class="p">]</span>
<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir el Preprocesador</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">model_numeric_vars</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span> <span class="n">model_categorical_vars</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># Definir el Pipeline para SVM</span>
<span class="n">pipeline_svm</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">(</span>
        <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span>  <span class="c1"># Puedes probar otros kernels como &#39;linear&#39;, &#39;poly&#39;</span>
        <span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span>
        <span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Necesario para curvas ROC</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">))</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">time_series_splits</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

    <span class="c1"># Entrenar el modelo</span>
    <span class="n">pipeline_svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-8 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-8 {
  color: var(--sklearn-color-text);
}

#sk-container-id-8 pre {
  padding: 0;
}

#sk-container-id-8 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-8 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-8 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-8 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-8 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-8 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-8 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-8 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-8 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-8 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-8 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-8 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-8 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-8 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-8 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-8 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-8 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-8 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-8 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-8 div.sk-label label.sk-toggleable__label,
#sk-container-id-8 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-8 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-8 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-8 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-8 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-8 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-8 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-8 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-8 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-8 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-8 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-8 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-8 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-8" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                handle_unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;, SVC(probability=True, random_state=42))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-52" type="checkbox" ><label for="sk-estimator-id-52" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                handle_unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;, SVC(probability=True, random_state=42))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-53" type="checkbox" ><label for="sk-estimator-id-53" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessor: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessor: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                 [&#x27;Cantidad de años de la empresa&#x27;,
                                  &#x27;Total de activos (Assets)&#x27;,
                                  &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                  &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;,
                                  &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;,
                                  &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;,
                                  &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]),
                                (&#x27;cat&#x27;,
                                 OneHotEncoder(drop=&#x27;first&#x27;,
                                               handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Estado actual&#x27;,
                                  &#x27;Concepto del Revisor fiscal en su orme&#x27;,
                                  &#x27;La compañía está obligada a tener Revisor &#x27;
                                  &#x27;fiscal?&#x27;,
                                  &#x27;Tipo societario&#x27;,
                                  &#x27;Departamento de la dirección del domicilio&#x27;,
                                  &#x27;Clasificación Industrial Internacional &#x27;
                                  &#x27;Uniforme Versión 4 A.C (CIIU)&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-54" type="checkbox" ><label for="sk-estimator-id-54" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Cantidad de años de la empresa&#x27;, &#x27;Total de activos (Assets)&#x27;, &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;, &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;, &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-55" type="checkbox" ><label for="sk-estimator-id-55" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-56" type="checkbox" ><label for="sk-estimator-id-56" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Estado actual&#x27;, &#x27;Concepto del Revisor fiscal en su orme&#x27;, &#x27;La compañía está obligada a tener Revisor fiscal?&#x27;, &#x27;Tipo societario&#x27;, &#x27;Departamento de la dirección del domicilio&#x27;, &#x27;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-57" type="checkbox" ><label for="sk-estimator-id-57" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(drop=&#x27;first&#x27;, handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-58" type="checkbox" ><label for="sk-estimator-id-58" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SVC<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.svm.SVC.html">?<span>Documentation for SVC</span></a></label><div class="sk-toggleable__content fitted"><pre>SVC(probability=True, random_state=42)</pre></div> </div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluar el Modelo SVM</span>
<span class="n">y_pred_svm</span> <span class="o">=</span> <span class="n">pipeline_svm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación - SVM:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_svm</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación - SVM:
              precision    recall  f1-score   support

          &lt;0       0.44      0.48      0.46      2466
   [0, 0.67)       0.44      0.53      0.49      2140
[0.67, 0.80)       0.00      0.00      0.00       479
   [0.80, 1)       0.73      0.26      0.39      1326
      [1, ∞)       0.62      0.76      0.69      2981

    accuracy                           0.53      9392
   macro avg       0.45      0.41      0.40      9392
weighted avg       0.52      0.53      0.50      9392
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_classification.py:1531: UndefinedMetricWarning:

Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.

/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_classification.py:1531: UndefinedMetricWarning:

Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.

/usr/local/lib/python3.10/dist-packages/sklearn/metrics/_classification.py:1531: UndefinedMetricWarning:

Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
</pre></div>
</div>
</div>
</div>
<p>El reporte de clasificación del modelo SVM muestra un desempeño general bajo, con una accuracy de 0.53 y métricas globales desiguales, evidenciadas por un macro F1-score de 0.40. Las clases <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80]</span></code> presentan un F1-score de 0.00, lo que indica que el modelo no las identifica correctamente, posiblemente debido a un desbalance en los datos o falta de características representativas. Aunque la clase <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞]</span></code> tiene el mejor rendimiento (F1-score de 0.69), las demás clases muestran problemas de recall y precisión.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizar la Matriz de Confusión</span>
<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_df</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Clase Verdadera&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clase Predicha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Matriz de Confusión para SVM</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_svm</span><span class="p">,</span> <span class="s1">&#39;Matriz de Confusión - SVM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1f214ddd5fd53a12ddd3cec77e47d7db4acb5ead78f5a6fc12a6d7f3a58a4437.png" src="_images/1f214ddd5fd53a12ddd3cec77e47d7db4acb5ead78f5a6fc12a6d7f3a58a4437.png" />
</div>
</div>
<p>La matriz de confusión para el modelo SVM revela importantes desafíos en el desempeño de clasificación. Las clases <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> y <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67]</span></code> tienen una cantidad significativa de ejemplos mal clasificados, evidenciada por las desviaciones hacia otras clases, especialmente hacia <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞]</span></code>, lo que sugiere un sesgo del modelo hacia esta última categoría. La clase <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80]</span></code> muestra un rendimiento crítico con casi todos sus valores clasificados incorrectamente como <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">0.67]</span></code> o <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1]</span></code>, alineándose con el F1-score de 0 reportado anteriormente. Por otro lado, aunque la clase <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞]</span></code> tiene el mayor soporte correctamente clasificado (2266), también absorbe numerosos valores mal predichos de otras categorías, reflejando una alta precisión pero un desequilibrio general en las predicciones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curvas ROC Multiclase</span>
<span class="c1"># Binarizar las etiquetas para ROC</span>
<span class="n">y_test_binarized</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="n">y_test_binarized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Obtener las probabilidades predichas para SVM</span>
<span class="n">y_score_svm</span> <span class="o">=</span> <span class="n">pipeline_svm</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para plotear Curvas ROC</span>
<span class="k">def</span> <span class="nf">plot_roc</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">fpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">tpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_score</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Clase </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">) - AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>  <span class="c1"># Línea diagonal</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Falsos Positivos (FPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Verdaderos Positivos (TPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Curvas ROC para SVM</span>
<span class="n">plot_roc</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">,</span> <span class="n">y_score_svm</span><span class="p">,</span> <span class="s1">&#39;Curvas ROC Multiclase - SVM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0dcf8f0bdee17b4f2450676a21ccfa4f6e34b5ec6e1b22865c3ce9c04627b4d3.png" src="_images/0dcf8f0bdee17b4f2450676a21ccfa4f6e34b5ec6e1b22865c3ce9c04627b4d3.png" />
</div>
</div>
<p>Las curvas ROC del modelo SVM muestran un desempeño variado entre clases, con las categorías <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1]</span></code> (AUC = 0.91) y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞]</span></code> (AUC = 0.89) destacando como las mejor clasificadas, mientras que las demás tienen AUC moderadas (entre 0.79 y 0.84). Aunque los valores de AUC sugieren que el modelo distingue bien las clases en términos probabilísticos, esto no se traduce completamente en buen desempeño concreto, como evidenciado por las métricas de precisión y recall en clases como <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Guardar el Modelo en Archivo Pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;modelo_svm.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_svm</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="c1"># Guardar el Modelo en Archivo Joblib (Opcional pero Recomendado)</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_svm</span><span class="p">,</span> <span class="s1">&#39;modelo_svm.joblib&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modelo SVM guardado exitosamente en archivos Pickle y Joblib.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo SVM guardado exitosamente en archivos Pickle y Joblib.
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-knn">
<h3>Modelo KNN<a class="headerlink" href="#modelo-knn" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear la variable objetivo &#39;FDC_FLC_categoria&#39;</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC/FLC&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Convertir variables categóricas a tipo &#39;category&#39;</span>
<span class="n">categorical_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Estado actual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Concepto del Revisor fiscal en su orme&#39;</span><span class="p">,</span>
    <span class="s1">&#39;La compañía está obligada a tener Revisor fiscal?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tipo societario&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Departamento de la dirección del domicilio&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>

<span class="c1"># Codificar la variable objetivo</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

<span class="c1"># Definir las Etiquetas y Crear `label_mapping`</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">label_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">label</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir las Variables del Modelo</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cantidad de años de la empresa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total de activos (Assets)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total pasivos (Liabilities)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Razón corriente&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación cartera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación proveedores&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nivel de endeudamiento&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Generación Efectivo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Desempleo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Ocupación&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB DEP&#39;</span>
<span class="p">]</span>

<span class="n">model_categorical_vars</span> <span class="o">=</span> <span class="n">categorical_vars</span>  <span class="c1"># Ya definidas y convertidas a &#39;category&#39;</span>

<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reducir la Multicolinealidad</span>
<span class="c1"># Calcular la matriz de correlación</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">model_numeric_vars</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>

<span class="c1"># Seleccionar la parte superior de la matriz de correlación</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">))</span>

<span class="c1"># Encontrar pares con correlación mayor a 0.8</span>
<span class="n">to_drop_corr</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variables a eliminar por alta correlación:&quot;</span><span class="p">,</span> <span class="n">to_drop_corr</span><span class="p">)</span>

<span class="c1"># Eliminar variables altamente correlacionadas</span>
<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model_numeric_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_drop_corr</span><span class="p">]</span>
<span class="n">model_vars</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="n">model_categorical_vars</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variables a eliminar por alta correlación: [&#39;Total pasivos (Liabilities)&#39;, &#39;Rotación proveedores&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definir el Preprocesador</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">model_numeric_vars</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span> <span class="n">model_categorical_vars</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># Definir el Pipeline para KNN</span>
<span class="n">pipeline_knn</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span>
        <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Puedes ajustar este parámetro</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">))</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">time_series_splits</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

    <span class="c1"># Entrenar el modelo</span>
    <span class="n">pipeline_knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-9 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-9 {
  color: var(--sklearn-color-text);
}

#sk-container-id-9 pre {
  padding: 0;
}

#sk-container-id-9 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-9 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-9 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-9 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-9 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-9 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-9 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-9 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-9 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-9 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-9 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-9 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-9 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-9 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-9 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-9 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-9 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-9 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-9 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-9 div.sk-label label.sk-toggleable__label,
#sk-container-id-9 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-9 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-9 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-9 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-9 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-9 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-9 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-9 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-9 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-9 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-9 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-9 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-9 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-9" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                handle_unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;, KNeighborsClassifier(n_jobs=-1))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-59" type="checkbox" ><label for="sk-estimator-id-59" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                                  [&#x27;Cantidad de años de la &#x27;
                                                   &#x27;empresa&#x27;,
                                                   &#x27;Total de activos (Assets)&#x27;,
                                                   &#x27;Razón corriente&#x27;,
                                                   &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                                   &#x27;ROE&#x27;,
                                                   &#x27;Nivel de endeudamiento&#x27;,
                                                   &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;,
                                                   &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;,
                                                   &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;,
                                                   &#x27;PIB DEP&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;,
                                                                handle_unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Estado actual&#x27;,
                                                   &#x27;Concepto del Revisor &#x27;
                                                   &#x27;fiscal en su orme&#x27;,
                                                   &#x27;La compañía está obligada &#x27;
                                                   &#x27;a tener Revisor fiscal?&#x27;,
                                                   &#x27;Tipo societario&#x27;,
                                                   &#x27;Departamento de la &#x27;
                                                   &#x27;dirección del domicilio&#x27;,
                                                   &#x27;Clasificación Industrial &#x27;
                                                   &#x27;Internacional Uniforme &#x27;
                                                   &#x27;Versión 4 A.C (CIIU)&#x27;])])),
                (&#x27;classifier&#x27;, KNeighborsClassifier(n_jobs=-1))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-60" type="checkbox" ><label for="sk-estimator-id-60" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessor: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessor: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;, StandardScaler(),
                                 [&#x27;Cantidad de años de la empresa&#x27;,
                                  &#x27;Total de activos (Assets)&#x27;,
                                  &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;,
                                  &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;,
                                  &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;,
                                  &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;,
                                  &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]),
                                (&#x27;cat&#x27;,
                                 OneHotEncoder(drop=&#x27;first&#x27;,
                                               handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Estado actual&#x27;,
                                  &#x27;Concepto del Revisor fiscal en su orme&#x27;,
                                  &#x27;La compañía está obligada a tener Revisor &#x27;
                                  &#x27;fiscal?&#x27;,
                                  &#x27;Tipo societario&#x27;,
                                  &#x27;Departamento de la dirección del domicilio&#x27;,
                                  &#x27;Clasificación Industrial Internacional &#x27;
                                  &#x27;Uniforme Versión 4 A.C (CIIU)&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-61" type="checkbox" ><label for="sk-estimator-id-61" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Cantidad de años de la empresa&#x27;, &#x27;Total de activos (Assets)&#x27;, &#x27;Razón corriente&#x27;, &#x27;Rotación cartera&#x27;, &#x27;ROA&#x27;, &#x27;ROE&#x27;, &#x27;Nivel de endeudamiento&#x27;, &#x27;Generación Efectivo&#x27;, &#x27;SD&#x27;, &#x27;FDC&#x27;, &#x27;Tasa de Desempleo&#x27;, &#x27;Tasa de Ocupación&#x27;, &#x27;PIB&#x27;, &#x27;PIB DEP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-62" type="checkbox" ><label for="sk-estimator-id-62" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-63" type="checkbox" ><label for="sk-estimator-id-63" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;Estado actual&#x27;, &#x27;Concepto del Revisor fiscal en su orme&#x27;, &#x27;La compañía está obligada a tener Revisor fiscal?&#x27;, &#x27;Tipo societario&#x27;, &#x27;Departamento de la dirección del domicilio&#x27;, &#x27;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-64" type="checkbox" ><label for="sk-estimator-id-64" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(drop=&#x27;first&#x27;, handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-65" type="checkbox" ><label for="sk-estimator-id-65" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;KNeighborsClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.5/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>KNeighborsClassifier(n_jobs=-1)</pre></div> </div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluar el Modelo KNN</span>
<span class="n">y_pred_knn</span> <span class="o">=</span> <span class="n">pipeline_knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reporte de clasificación - KNN:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_knn</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reporte de clasificación - KNN:
              precision    recall  f1-score   support

          &lt;0       0.28      0.41      0.34      2466
   [0, 0.67)       0.28      0.30      0.29      2140
[0.67, 0.80)       0.11      0.04      0.05       479
   [0.80, 1)       0.33      0.15      0.21      1326
      [1, ∞)       0.43      0.40      0.41      2981

    accuracy                           0.33      9392
   macro avg       0.29      0.26      0.26      9392
weighted avg       0.33      0.33      0.32      9392
</pre></div>
</div>
</div>
</div>
<p>El  modelo KNN muestra un desempeño muy bajo en todas las clases, con un <strong>accuracy global de 0.33</strong> y un macro F1-score de 0.26, lo que refleja un modelo incapaz de realizar predicciones efectivas. Las clases <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80]</span></code> y <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1]</span></code> son las más afectadas, con F1-scores de 0.05 y 0.21 respectivamente, indicando que el modelo falla en identificar correctamente estas categorías. La clase <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞]</span></code> tiene el mejor rendimiento relativo (F1-score de 0.41), pero sigue siendo insuficiente. Estos resultados sugieren que el modelo KNN no está adaptado a los datos, posiblemente debido a características no representativas o una mala elección de hiperparámetros, como el número de vecinos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizar la Matriz de Confusión</span>
<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">cm_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm_df</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Clase Verdadera&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Clase Predicha&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Matriz de Confusión para KNN</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_knn</span><span class="p">,</span> <span class="s1">&#39;Matriz de Confusión - KNN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c9d1d2180fc2ca65fd79f0821585d149fa8d615c1042b157c84d34dfc4099333.png" src="_images/c9d1d2180fc2ca65fd79f0821585d149fa8d615c1042b157c84d34dfc4099333.png" />
</div>
</div>
<p>La matriz de confusión del modelo KNN muestra un desempeño deficiente con una alta cantidad de clasificaciones incorrectas en todas las clases. La clase <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> presenta una proporción significativa de ejemplos mal clasificados como <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞]</span></code> (804 casos). Estos resultados sugieren que KNN no maneja bien las relaciones entre las clases en este conjunto de datos, posiblemente debido a características mal escaladas, alta dimensionalidad o una elección subóptima del número de vecinos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Curvas ROC Multiclase</span>
<span class="c1"># Binarizar las etiquetas para ROC</span>
<span class="n">y_test_binarized</span> <span class="o">=</span> <span class="n">label_binarize</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">label_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="n">y_test_binarized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Obtener las probabilidades predichas para KNN</span>
<span class="n">y_score_knn</span> <span class="o">=</span> <span class="n">pipeline_knn</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para plotear Curvas ROC</span>
<span class="k">def</span> <span class="nf">plot_roc</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_score</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">fpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">tpr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_score</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_classes</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Clase </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">label_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">) - AUC = </span><span class="si">{</span><span class="n">roc_auc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>  <span class="c1"># Línea diagonal</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Falsos Positivos (FPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Verdaderos Positivos (TPR)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Curvas ROC para KNN</span>
<span class="n">plot_roc</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">,</span> <span class="n">y_score_knn</span><span class="p">,</span> <span class="s1">&#39;Curvas ROC Multiclase - KNN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/67a143687d3d1f26c2901a0e1cd5f83aa0d89ead32bcd49542d631b0af7bf06d.png" src="_images/67a143687d3d1f26c2901a0e1cd5f83aa0d89ead32bcd49542d631b0af7bf06d.png" />
</div>
</div>
<p>Las curvas ROC del modelo KNN muestran un desempeño muy limitado para todas las clases, con valores de AUC que oscilan entre 0.54 y 0.66. La clase <code class="docutils literal notranslate"><span class="pre">[0.80,</span> <span class="pre">1]</span></code> (AUC = 0.66) y <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">∞]</span></code> (AUC = 0.62) tienen el mejor desempeño relativo, aunque siguen siendo bajos para estándares aceptables. Las clases <code class="docutils literal notranslate"><span class="pre">&lt;0</span></code> (AUC = 0.55) y <code class="docutils literal notranslate"><span class="pre">[0.67,</span> <span class="pre">0.80]</span></code> (AUC = 0.54) reflejan una incapacidad para discriminar adecuadamente los ejemplos positivos de negativos. Estas métricas indican que el modelo KNN no puede aprovechar eficazmente la estructura de los datos para diferenciar las clases, probablemente debido a problemas como la elección inadecuada del número de vecinos, datos no normalizados o características poco discriminativas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Guardar el Modelo en Archivo Pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;modelo_knn.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_knn</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="c1"># Guardar el Modelo en Archivo Joblib (Opcional pero Recomendado)</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline_knn</span><span class="p">,</span> <span class="s1">&#39;modelo_knn.joblib&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Modelo KNN guardado exitosamente en archivos Pickle y Joblib.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo KNN guardado exitosamente en archivos Pickle y Joblib.
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelamiento-2">
<h1>Modelamiento 2<a class="headerlink" href="#modelamiento-2" title="Link to this heading">#</a></h1>
<section id="id1">
<h2>Modelo de regresión logística multinomial<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;0&#39;</span><span class="p">,</span> <span class="s1">&#39;[0, 0.67)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.67, 0.80)&#39;</span><span class="p">,</span> <span class="s1">&#39;[0.80, 1)&#39;</span><span class="p">,</span> <span class="s1">&#39;[1, ∞)&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FDC/FLC&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">categorical_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Estado actual&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Concepto del Revisor fiscal en su orme&#39;</span><span class="p">,</span>
    <span class="s1">&#39;La compañía está obligada a tener Revisor fiscal?&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tipo societario&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Departamento de la dirección del domicilio&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Clasificación Industrial Internacional Uniforme Versión 4 A.C (CIIU)&#39;</span>
<span class="p">]</span>

<span class="n">model_numeric_vars</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Cantidad de años de la empresa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Total de activos (Assets)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Razón corriente&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Rotación cartera&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ROE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nivel de endeudamiento&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Generación Efectivo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SD&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FDC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Desempleo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Tasa de Ocupación&#39;</span><span class="p">,</span>
    <span class="s1">&#39;PIB DEP&#39;</span>
<span class="p">]</span>

<span class="n">categorical_vars_extended</span> <span class="o">=</span> <span class="n">categorical_vars</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span>  <span class="c1"># Añadir la variable objetivo</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_vars_extended</span><span class="p">:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">predictor_vars</span> <span class="o">=</span> <span class="n">categorical_vars</span> <span class="o">+</span> <span class="n">model_numeric_vars</span>

<span class="c1"># Para cada variable predictora, creamos una versión rezagada de un año</span>
<span class="n">lagged_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;NIT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">lagged_data</span> <span class="o">=</span> <span class="n">lagged_data</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s1">&#39;_lag1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;NIT_lag1&#39;</span><span class="p">,</span>                   <span class="c1"># Identificador único no es necesario como predictor</span>
    <span class="s1">&#39;Fecha de Corte_lag1&#39;</span><span class="p">,</span>        <span class="c1"># Variable de tiempo no es necesaria como predictor</span>
    <span class="s1">&#39;FDC/FLC_lag1&#39;</span><span class="p">,</span>               <span class="c1"># Puede estar correlacionada con la categoría objetivo</span>
    <span class="s1">&#39;FDC_FLC_categoria_lag1&#39;</span><span class="p">,</span>      <span class="c1"># Variable objetivo rezagada no debe incluirse</span>
    <span class="c1"># &#39;SD_lag1&#39;,</span>
    <span class="c1"># &#39;FDC_lag1&#39;,</span>
    <span class="c1"># &#39;FLC_lag1&#39;</span>
<span class="p">]</span>
<span class="n">lagged_data</span> <span class="o">=</span> <span class="n">lagged_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns_to_drop</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">lagged_data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">lagged_predictor_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_lag1&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">predictor_vars</span><span class="p">]</span>
<span class="n">all_predictor_vars</span> <span class="o">=</span> <span class="n">predictor_vars</span> <span class="o">+</span> <span class="n">lagged_predictor_vars</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identificar variables numéricas y categóricas entre las predictoras</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="n">model_numeric_vars</span> <span class="o">+</span> <span class="p">[</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_lag1&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model_numeric_vars</span><span class="p">]</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">categorical_vars</span> <span class="o">+</span> <span class="p">[</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_lag1&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">categorical_vars</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="c1"># Crear el transformador para columnas</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 12. Inicializar variables para almacenar métricas</span>
<span class="n">metrics_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># 13. Obtener la lista de años únicos y ordenarlos</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># 14. Inicializar un diccionario para almacenar los modelos entrenados por año (opcional)</span>
<span class="n">trained_models</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Procesando el año: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Definir el conjunto de entrenamiento: datos de años anteriores a &#39;year&#39;</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">year</span><span class="p">]</span>

    <span class="c1"># Definir el conjunto de prueba: datos del &#39;year&#39; actual</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Fecha de Corte&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>

    <span class="c1"># Si no hay datos de entrenamiento, continuar</span>
    <span class="k">if</span> <span class="n">train_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No hay datos de entrenamiento para el año </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">. Saltando...&quot;</span><span class="p">)</span>
        <span class="k">continue</span>

    <span class="c1"># Definir X y y para entrenamiento</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">all_predictor_vars</span><span class="p">]</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span>

    <span class="c1"># Definir X y y para prueba</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="n">all_predictor_vars</span><span class="p">]</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;FDC_FLC_categoria&#39;</span><span class="p">]</span>

    <span class="c1"># Crear el pipeline con preprocesamiento y modelo</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
    <span class="p">])</span>

    <span class="c1"># Entrenar el modelo</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="c1"># Guardar el modelo entrenado para este año (opcional)</span>
    <span class="n">trained_models</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline</span>

    <span class="c1"># Predecir en el conjunto de prueba</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_proba</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Evaluar las métricas</span>
    <span class="c1"># Para ROC AUC en clasificación multiclase, se puede usar &#39;ovo&#39; o &#39;ovr&#39;</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="n">LabelBinarizer</span><span class="p">()</span>
    <span class="n">lb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_test_binarized</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y_test_binarized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">y_test_binarized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_test_binarized</span><span class="p">,</span> <span class="n">y_test_binarized</span><span class="p">))</span>

    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;macro&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;ovr&#39;</span><span class="p">)</span>

    <span class="c1"># Calcular la matriz de confusión</span>
    <span class="n">conf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Calcular reporte de clasificación</span>
    <span class="n">class_report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Almacenar las métricas</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
        <span class="s1">&#39;roc_auc&#39;</span><span class="p">:</span> <span class="n">roc_auc</span><span class="p">,</span>
        <span class="s1">&#39;confusion_matrix&#39;</span><span class="p">:</span> <span class="n">conf_matrix</span><span class="p">,</span>
        <span class="s1">&#39;classification_report&#39;</span><span class="p">:</span> <span class="n">class_report</span>
    <span class="p">}</span>
    <span class="n">metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

    <span class="c1"># Imprimir las métricas para el año actual</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Año: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ROC AUC: </span><span class="si">{</span><span class="n">roc_auc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matriz de Confusión:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reporte de Clasificación:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">))</span>

    <span class="c1"># Graficar la matriz de confusión</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicho&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Matriz de Confusión para el año </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Graficar ROC para cada clase</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">class_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">y_test_binarized</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_test_binarized</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">y_proba</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">])</span>
            <span class="n">roc_auc_class</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Clase </span><span class="si">{</span><span class="n">class_label</span><span class="si">}</span><span class="s1"> (AUC = </span><span class="si">{</span><span class="n">roc_auc_class</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Curvas ROC para el año </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Falsos Positivos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Verdaderos Positivos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando el año: 2018
No hay datos de entrenamiento para el año 2018. Saltando...

Procesando el año: 2019
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning: &#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Año: 2019
ROC AUC: 0.8697
Matriz de Confusión:
[[449  98   0  15 128]
 [110 249   0  43  44]
 [  9  43   4  35   4]
 [ 11  54   4 138  12]
 [ 88  34   0   6 684]]
Reporte de Clasificación:
              precision    recall  f1-score   support

          &lt;0       0.67      0.65      0.66       690
   [0, 0.67)       0.52      0.56      0.54       446
[0.67, 0.80)       0.50      0.04      0.08        95
   [0.80, 1)       0.58      0.63      0.61       219
      [1, ∞)       0.78      0.84      0.81       812

    accuracy                           0.67      2262
   macro avg       0.61      0.54      0.54      2262
weighted avg       0.67      0.67      0.66      2262
</pre></div>
</div>
<img alt="_images/bae48e6e490e91dafd02135d64e97db5b73fcfd4f3789da4e8a9f10eff280ea7.png" src="_images/bae48e6e490e91dafd02135d64e97db5b73fcfd4f3789da4e8a9f10eff280ea7.png" />
<img alt="_images/52c76a5fefc7009b80d01f3235e2d1bbe60c7a8ea45474fe275c2e9c246d9cbc.png" src="_images/52c76a5fefc7009b80d01f3235e2d1bbe60c7a8ea45474fe275c2e9c246d9cbc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando el año: 2020
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning: &#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Año: 2020
ROC AUC: 0.8904
Matriz de Confusión:
[[385  37   2   2 363]
 [155 310   4  15 188]
 [  8  71   3  35  31]
 [ 11  77   8 253  53]
 [ 15   6   4   2 955]]
Reporte de Clasificación:
              precision    recall  f1-score   support

          &lt;0       0.67      0.49      0.56       789
   [0, 0.67)       0.62      0.46      0.53       672
[0.67, 0.80)       0.14      0.02      0.04       148
   [0.80, 1)       0.82      0.63      0.71       402
      [1, ∞)       0.60      0.97      0.74       982

    accuracy                           0.64      2993
   macro avg       0.57      0.51      0.52      2993
weighted avg       0.63      0.64      0.61      2993
</pre></div>
</div>
<img alt="_images/37eea9c49b7f2ccc4cc2ce3b3380ba0923ba7960959d048ea698227a6edbf6a9.png" src="_images/37eea9c49b7f2ccc4cc2ce3b3380ba0923ba7960959d048ea698227a6edbf6a9.png" />
<img alt="_images/a3053ec19d75c323918e7759d4cc638188f0fc5321f1a34b14308f7182613de5.png" src="_images/a3053ec19d75c323918e7759d4cc638188f0fc5321f1a34b14308f7182613de5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando el año: 2021
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning: &#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Año: 2021
ROC AUC: 0.8840
Matriz de Confusión:
[[ 567   94    1    2  233]
 [  80  609    4   31   62]
 [   3  141    3   41    8]
 [   5  241    4  214   18]
 [ 112   15    0    1 1005]]
Reporte de Clasificación:
              precision    recall  f1-score   support

          &lt;0       0.74      0.63      0.68       897
   [0, 0.67)       0.55      0.77      0.65       786
[0.67, 0.80)       0.25      0.02      0.03       196
   [0.80, 1)       0.74      0.44      0.56       482
      [1, ∞)       0.76      0.89      0.82      1133

    accuracy                           0.69      3494
   macro avg       0.61      0.55      0.55      3494
weighted avg       0.68      0.69      0.66      3494
</pre></div>
</div>
<img alt="_images/cfb2cb85b03fcca720f3d18b57cd7aea6820f31b9b4d5710850165ef5dc86409.png" src="_images/cfb2cb85b03fcca720f3d18b57cd7aea6820f31b9b4d5710850165ef5dc86409.png" />
<img alt="_images/25e9ad14d4910349969bfaf11967aa17396fd241a7d5924495ee26251341e903.png" src="_images/25e9ad14d4910349969bfaf11967aa17396fd241a7d5924495ee26251341e903.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando el año: 2022
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning: &#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Año: 2022
ROC AUC: 0.9081
Matriz de Confusión:
[[ 522   57    1    2  342]
 [  60  538    4   48  100]
 [   2  115    2   64    7]
 [   2  149    7  365   22]
 [  23   11    0    1 1140]]
Reporte de Clasificación:
              precision    recall  f1-score   support

          &lt;0       0.86      0.56      0.68       924
   [0, 0.67)       0.62      0.72      0.66       750
[0.67, 0.80)       0.14      0.01      0.02       190
   [0.80, 1)       0.76      0.67      0.71       545
      [1, ∞)       0.71      0.97      0.82      1175

    accuracy                           0.72      3584
   macro avg       0.62      0.59      0.58      3584
weighted avg       0.71      0.72      0.69      3584
</pre></div>
</div>
<img alt="_images/0f86fbb3ced91770b7bc131aab3e1a35b0b083f90b7b4f08e729e50080a84baa.png" src="_images/0f86fbb3ced91770b7bc131aab3e1a35b0b083f90b7b4f08e729e50080a84baa.png" />
<img alt="_images/6e54b0a322f85924addba81ea575920c9ebaf5bdd16df95c758828f04ebfe4a1.png" src="_images/6e54b0a322f85924addba81ea575920c9ebaf5bdd16df95c758828f04ebfe4a1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Procesando el año: 2023
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.10/dist-packages/sklearn/linear_model/_logistic.py:1247: FutureWarning: &#39;multi_class&#39; was deprecated in version 1.5 and will be removed in 1.7. From then on, it will always use &#39;multinomial&#39;. Leave it to its default value to avoid this warning.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Año: 2023
ROC AUC: 0.9281
Matriz de Confusión:
[[ 809   36    0    2  238]
 [  99  682    5   49   65]
 [   1   93    1   88    2]
 [   1  130    2  326   24]
 [  39    5    1    1 1119]]
Reporte de Clasificación:
              precision    recall  f1-score   support

          &lt;0       0.85      0.75      0.80      1085
   [0, 0.67)       0.72      0.76      0.74       900
[0.67, 0.80)       0.11      0.01      0.01       185
   [0.80, 1)       0.70      0.67      0.69       483
      [1, ∞)       0.77      0.96      0.86      1165

    accuracy                           0.77      3818
   macro avg       0.63      0.63      0.62      3818
weighted avg       0.74      0.77      0.75      3818
</pre></div>
</div>
<img alt="_images/888dbd19b922b2a68d1dda58309e57cfe20d08ffcefb50602f90c93f46ecd33c.png" src="_images/888dbd19b922b2a68d1dda58309e57cfe20d08ffcefb50602f90c93f46ecd33c.png" />
<img alt="_images/b4272b29c83c2b7e038bb9e0c436d2f3cd3168c7a71604847ac1705c4cb586ff.png" src="_images/b4272b29c83c2b7e038bb9e0c436d2f3cd3168c7a71604847ac1705c4cb586ff.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 16. Crear un DataFrame con las métricas recopiladas</span>
<span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Resumen de Métricas por Año:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_auc&#39;</span><span class="p">]])</span>

<span class="c1"># Guardar el DataFrame de métricas</span>
<span class="n">metrics_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;metrics_summary.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resumen de Métricas por Año:
   year   roc_auc
0  2019  0.869704
1  2020  0.890399
2  2021  0.883996
3  2022  0.908142
4  2023  0.928121
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">last_year</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">final_model</span> <span class="o">=</span> <span class="n">trained_models</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">last_year</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="k">if</span> <span class="n">final_model</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;final_multinomial_logit_model.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">final_model</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Modelo entrenado para el año </span><span class="si">{</span><span class="n">last_year</span><span class="si">}</span><span class="s2"> guardado como &#39;final_multinomial_logit_model.pkl&#39;.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se encontró un modelo para guardar.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modelo entrenado para el año 2023 guardado como &#39;final_multinomial_logit_model.pkl&#39;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 18. Opcional: Visualizar las métricas recopiladas</span>
<span class="c1"># Por ejemplo, graficar ROC AUC por año</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">metrics_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ROC AUC por Año&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Año&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;ROC AUC&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2128b8e10005f64ad48e4ce963eec9a36d31cb60705b28431f50f5b0cad97957.png" src="_images/2128b8e10005f64ad48e4ce963eec9a36d31cb60705b28431f50f5b0cad97957.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="edapyme.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Exploración de datos</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-y-paquetes-necesarios">Librerías y paquetes necesarios</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis">Análisis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mirar-por-ano-datos-faltantes">Mirar por año datos faltantes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputacion-de-datos">Imputación de datos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#verificar-vif">Verificar VIF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelamiento">Modelamiento</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion-logistica-multinomial">Modelo de regresión logística Multinomial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion-logistica-multinomial-generalizado">Modelo de regresión logistica multinomial generalizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#xgbooost">XGBOOOST</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-svm">Modelo SVM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-knn">Modelo KNN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelamiento-2">Modelamiento 2</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Modelo de regresión logística multinomial</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kelly Beltran Y Henry Saenz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>